(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6392:function(e,t,r){Promise.resolve().then(r.bind(r,6763))},6763:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return e1}});var a=r(7437),s=r(2265),i=r(5466),l=r(5252),n=r(6818),o=r(8906),d=r(2369),c=r(64),x=r(7053),m=r(9376),g=r(265),u=r(5051),h=r(2135),y=r(875),p=r(740),b=r(5929),f=r(7226),j=r(9202),v=r(525),N=r(3085),w=r(4401),k=r(3247),S=r(5805);let C=e=>{let{symbol:t,size:r=24,className:s=""}=e;return(e=>{switch(e.toUpperCase()){case"BTC":return(0,a.jsxs)("svg",{width:r,height:r,viewBox:"0 0 24 24",fill:"none",className:s,children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"11",fill:"#F7931A"}),(0,a.jsx)("path",{d:"M8.5 6.5h4.5c1.5 0 2.5 1 2.5 2.5s-1 2.5-2.5 2.5H8.5v-5zm0 7h5c1.5 0 2.5 1 2.5 2.5s-1 2.5-2.5 2.5h-5v-5z",fill:"white"}),(0,a.jsx)("circle",{cx:"10",cy:"9",r:"1",fill:"#F7931A"}),(0,a.jsx)("circle",{cx:"14",cy:"15",r:"1",fill:"#F7931A"})]});case"ETH":return(0,a.jsxs)("svg",{width:r,height:r,viewBox:"0 0 24 24",fill:"none",className:s,children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"11",fill:"#627EEA"}),(0,a.jsx)("path",{d:"M12 4l6 8-6 4-6-4 6-8zm0 12l6-4-6 8-6-8 6 4z",fill:"white",opacity:"0.9"})]});case"SOL":return(0,a.jsxs)("svg",{width:r,height:r,viewBox:"0 0 24 24",fill:"none",className:s,children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"11",fill:"#00D4AA"}),(0,a.jsx)("path",{d:"M12 6l3 3-3 3-3-3 3-3zm0 6l3 3-3 3-3-3 3-3z",fill:"white"}),(0,a.jsx)("circle",{cx:"12",cy:"9",r:"1",fill:"#00D4AA"}),(0,a.jsx)("circle",{cx:"12",cy:"15",r:"1",fill:"#00D4AA"})]});case"BNB":return(0,a.jsxs)("svg",{width:r,height:r,viewBox:"0 0 24 24",fill:"none",className:s,children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"11",fill:"#F3BA2F"}),(0,a.jsx)("path",{d:"M12 6l2 2-2 2-2-2 2-2zm0 4l2 2-2 2-2-2 2-2zm-3-1l2 2-2 2-2-2 2-2zm6 0l2 2-2 2-2-2 2-2zm-3 5l2 2-2 2-2-2 2-2z",fill:"white"})]});case"ADA":return(0,a.jsxs)("svg",{width:r,height:r,viewBox:"0 0 24 24",fill:"none",className:s,children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"11",fill:"#0033AD"}),(0,a.jsx)("path",{d:"M12 6l1 3-1 2-1-2 1-3zm0 5l1 3-1 2-1-2 1-3zm-2-4l1 3-1 2-1-2 1-3zm4 0l1 3-1 2-1-2 1-3z",fill:"white"})]});case"DOGE":return(0,a.jsxs)("svg",{width:r,height:r,viewBox:"0 0 24 24",fill:"none",className:s,children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"11",fill:"#C2A633"}),(0,a.jsx)("path",{d:"M8 10h8v2H8v-2zm0 4h8v2H8v-2zm-1-6h2v12H7V8zm8 0h2v12h-2V8z",fill:"white"}),(0,a.jsx)("circle",{cx:"10",cy:"12",r:"1",fill:"#C2A633"}),(0,a.jsx)("circle",{cx:"14",cy:"12",r:"1",fill:"#C2A633"})]});case"XRP":return(0,a.jsxs)("svg",{width:r,height:r,viewBox:"0 0 24 24",fill:"none",className:s,children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"11",fill:"#23292F"}),(0,a.jsx)("path",{d:"M6 8h12v2H6V8zm0 6h12v2H6v-2zm3-3h6v2H9v-2z",fill:"white"}),(0,a.jsx)("circle",{cx:"9",cy:"9",r:"1",fill:"#23292F"}),(0,a.jsx)("circle",{cx:"15",cy:"15",r:"1",fill:"#23292F"})]});case"LTC":return(0,a.jsxs)("svg",{width:r,height:r,viewBox:"0 0 24 24",fill:"none",className:s,children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"11",fill:"#BFBBBB"}),(0,a.jsx)("path",{d:"M8 6h8v2H8V6zm0 4h8v2H8v-2zm0 4h8v2H8v-2zm4 2l2 4-2-2-2 2 2 4z",fill:"white"}),(0,a.jsx)("circle",{cx:"12",cy:"12",r:"1",fill:"#BFBBBB"})]});case"MATIC":return(0,a.jsxs)("svg",{width:r,height:r,viewBox:"0 0 24 24",fill:"none",className:s,children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"11",fill:"#8247E5"}),(0,a.jsx)("path",{d:"M8 8l8 0v4l-4 4-4-4V8zm4 4l2 2-2 2-2-2 2-2z",fill:"white"}),(0,a.jsx)("circle",{cx:"12",cy:"10",r:"1",fill:"#8247E5"})]});case"LINK":return(0,a.jsxs)("svg",{width:r,height:r,viewBox:"0 0 24 24",fill:"none",className:s,children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"11",fill:"#2A5ADA"}),(0,a.jsx)("path",{d:"M8 10l4-4 4 4-4 4-4-4zm0 4l4 4 4-4-4-4-4 4z",fill:"white"}),(0,a.jsx)("circle",{cx:"12",cy:"12",r:"1.5",fill:"#2A5ADA"})]});default:return(0,a.jsxs)("svg",{width:r,height:r,viewBox:"0 0 24 24",fill:"none",className:s,children:[(0,a.jsx)("circle",{cx:"12",cy:"12",r:"11",fill:"#6B7280"}),(0,a.jsx)("text",{x:"12",y:"16",textAnchor:"middle",fill:"white",fontSize:"10",fontWeight:"bold",children:e.slice(0,3).toUpperCase()})]})}})(t)};var A=r(243);let F=e=>{let[t,r]=(0,s.useState)(new Map),[a,i]=(0,s.useState)(!1),l=(0,s.useRef)(null),n=(0,s.useRef)(null);return(0,s.useEffect)(()=>{if(!e||0===e.length)return;let t=()=>{let a=e.map(e=>e.toLowerCase().replace(/usdt$/i,"")).map(e=>"".concat(e,"usdt@ticker")).join("/"),s="wss://stream.binance.com:9443/stream?streams=".concat(a);console.log("Connecting to Binance WebSocket:",s);let o=new WebSocket(s);l.current=o,o.onopen=()=>{console.log("Binance WebSocket connected."),i(!0),n.current&&(clearTimeout(n.current),n.current=null)},o.onmessage=e=>{try{let t=JSON.parse(e.data),a=t.data||t;if(!a.s)return;let s=a.s.replace(/USDT$/i,""),i={symbol:s,price:parseFloat(a.c),change:parseFloat(a.P),volume:parseFloat(a.v),timestamp:a.E};r(e=>new Map(e).set(s,i))}catch(e){console.error("Error processing WebSocket message:",e)}},o.onerror=e=>{console.error("Binance WebSocket error:",e),i(!1)},o.onclose=e=>{i(!1),console.log("Binance WebSocket disconnected. Code:",e.code),1e3===e.code||n.current||(console.log("Attempting to reconnect in 3 seconds..."),n.current=setTimeout(()=>{n.current=null,t()},3e3))}};return t(),()=>{console.log("Cleaning up WebSocket connection."),n.current&&(clearTimeout(n.current),n.current=null),l.current&&(l.current.close(1e3),l.current=null),i(!1)}},[e]),{prices:t,isConnected:a}},E={BTC:{id:"btc",name:"Bitcoin"},ETH:{id:"eth",name:"Ethereum"},SOL:{id:"sol",name:"Solana"},BNB:{id:"bnb",name:"Binance Coin"},ADA:{id:"ada",name:"Cardano"},DOGE:{id:"doge",name:"Dogecoin"},XRP:{id:"xrp",name:"Ripple"},LTC:{id:"ltc",name:"Litecoin"},MATIC:{id:"matic",name:"Polygon"},LINK:{id:"link",name:"Chainlink"}},T=s.memo(e=>{let{title:t,children:r,className:s="",icon:i}=e;return(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-xl border border-gray-100 dark:border-gray-700 transition-colors duration-300 ".concat(s),children:[t&&(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-800 dark:text-gray-100",children:t}),i&&(0,a.jsx)(i,{className:"w-6 h-6 text-indigo-500 dark:text-indigo-400"})]}),r]})});T.displayName="Card";let D=s.memo(e=>{let{history:t}=e,r=Math.min(...t),s=Math.max(...t)-r,i=t.map((e,a)=>{let i=a/(t.length-1)*100,l=40-(e-r)/(s||1)*40;return"".concat(i,",").concat(l)}).join(" "),l=t[t.length-1]>t[0];return(0,a.jsx)("svg",{viewBox:"0 0 ".concat(100," ").concat(40),className:"w-full h-10 -my-2",children:(0,a.jsx)("polyline",{fill:"none",stroke:l?"#10B981":"#EF4444",strokeWidth:"2",points:i})})});D.displayName="Sparkline";let P=s.memo(e=>{let{coin:t,sparklineHistory:r=[],isUpdating:s=!1}=e,i=t.change>=0,l=i?g.Z:u.Z,n=r.length>0?r:[.98*t.price,.99*t.price,t.price,1.01*t.price,1.02*t.price,1.01*t.price,t.price];return(0,a.jsxs)("div",{className:"grid items-center grid-cols-12 py-4 transition-all duration-300 border-b border-gray-100 dark:border-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700/50 last:border-b-0 ".concat(s?"bg-yellow-50 dark:bg-yellow-900/20":""),children:[(0,a.jsxs)("div",{className:"flex items-center col-span-4 space-x-4 md:col-span-3",children:[(0,a.jsx)(C,{symbol:t.symbol,size:40,className:"shrink-0"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.symbol}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:t.name})]})]}),(0,a.jsx)("div",{className:"col-span-3 text-left md:col-span-3",children:(0,a.jsxs)("p",{className:"text-lg font-medium text-gray-900 dark:text-white",children:["$",t.price.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]})}),(0,a.jsx)("div",{className:"col-span-3 text-center md:col-span-2",children:(0,a.jsxs)("div",{className:"inline-flex items-center text-sm font-semibold p-1 px-2 rounded-full ".concat(i?"bg-green-100 text-green-700 dark:bg-green-700 dark:text-green-100":"bg-red-100 text-red-700 dark:bg-red-700 dark:text-red-100"),children:[(0,a.jsx)(l,{className:"w-3 h-3 mr-1"}),Math.abs(t.change).toFixed(2),"%"]})}),(0,a.jsxs)("div",{className:"hidden text-right text-gray-600 md:block md:col-span-2 dark:text-gray-300",children:["$",t.volume.toFixed(1),"B"]}),(0,a.jsx)("div",{className:"hidden col-span-2 lg:block",children:(0,a.jsx)(D,{history:n})})]})});P.displayName="CoinRow";let L=s.memo(e=>{let{currentTimeFrame:t,setTimeFrame:r}=e;return(0,a.jsx)("div",{className:"flex p-1 space-x-2 bg-gray-100 rounded-full dark:bg-gray-700",children:["24h","7d","30d","All"].map(e=>(0,a.jsx)("button",{onClick:()=>r(e),className:"px-3 py-1 text-sm font-medium rounded-full transition-colors duration-200 ".concat(t===e?"bg-indigo-600 text-white shadow-md":"text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"),children:e},e))})});L.displayName="TimeFrameSelector";let B=s.memo(e=>{let{column:t,label:r,currentSort:s,handleSort:i}=e,l=s.key===t,n=l?"asc"===s.order?h.Z:y.Z:p.Z;return(0,a.jsxs)("button",{onClick:()=>i(t),className:"flex items-center space-x-1 text-xs font-semibold tracking-wider text-gray-500 uppercase transition-colors dark:text-gray-400 hover:text-indigo-500",children:[(0,a.jsx)("span",{children:r}),(0,a.jsx)(n,{className:"w-3 h-3 ".concat(l?"text-indigo-500":"text-gray-400")})]})});function M(){var e;let t=(0,m.useRouter)(),{user:i,isAuthenticated:n}=(0,A.a)(),[o,d]=(0,s.useState)([]),[c,x]=(0,s.useState)(!0),[g,u]=(0,s.useState)(""),[h,y]=(0,s.useState)("24h"),[C,D]=(0,s.useState)(!1),[M,Z]=(0,s.useState)({key:"price",order:"desc"}),[z,U]=(0,s.useState)(null),[I,R]=(0,s.useState)(!0),[O,Y]=(0,s.useState)(new Set),{prices:K,isConnected:V}=F(["BTCUSDT","ETHUSDT","SOLUSDT","BNBUSDT","ADAUSDT","DOGEUSDT","XRPUSDT","LTCUSDT","MATICUSDT","LINKUSDT"]),q=function(e){let t=(0,s.useRef)();return(0,s.useEffect)(()=>{t.current=e}),t.current}(o);(0,s.useEffect)(()=>{let e=async()=>{if(!n||!i){R(!1);return}try{let e=localStorage.getItem("accessToken");if(!e){R(!1);return}let{safeFetch:t}=await Promise.resolve().then(r.bind(r,3500)),a=await t("/api/portfolio",{headers:{Authorization:"Bearer ".concat(e)}},2,700);a.ok?U(a.data):console.error("Home fetchPortfolio error:",a.error,"status:",a.status)}catch(e){console.error("Error fetching portfolio:",e)}finally{R(!1)}};e();let t=setInterval(e,3e4);return()=>clearInterval(t)},[n,i]),(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/binance"),t=await e.json(),r=Array.isArray(t)?t.map(e=>{let t=(null==e?void 0:e.symbol)||"",r=t.replace(/USDT$/i,"").replace(/USD$/i,""),a=E[r]||{id:(r||t).toLowerCase(),name:r||t},s=Number(null==e?void 0:e.price)||0,i=Number(null==e?void 0:e.change)||0,l=Number(null==e?void 0:e.volume)||0;return{id:a.id,name:a.name,symbol:r||t,price:s,change:i,volume:l}}):[];d(r),x(!1)}catch(e){console.error("Error fetching crypto data:",e),x(!1)}})()},[]),(0,s.useEffect)(()=>{K.size>0&&d(e=>e.map(e=>{let t=K.get(e.symbol);return t?{...e,price:t.price,change:t.change,volume:t.volume}:e}))},[K]),(0,s.useEffect)(()=>{if(q&&q.length>0&&o.length>0){let e=new Set;for(let t of o){let r=q.find(e=>e.id===t.id);r&&r.price!==t.price&&e.add(t.symbol)}if(e.size>0){Y(t=>{let r=new Set(t);return e.forEach(e=>r.add(e)),r});let t=setTimeout(()=>{Y(t=>{let r=new Set(t);return e.forEach(e=>r.delete(e)),r})},1500);return()=>clearTimeout(t)}}},[o,q]),(0,s.useEffect)(()=>{C?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[C]);let $=(0,s.useCallback)(e=>{Z(t=>({key:e,order:t.key===e&&"desc"===t.order?"asc":"desc"}))},[]),H=(0,s.useCallback)(()=>{n?t.push("/dashboard"):t.push("/signup")},[n,t]),W=(0,s.useCallback)(()=>{t.push("/trade?action=buy")},[t]),G=(0,s.useCallback)(()=>{t.push("/trade?action=sell")},[t]),_=(0,s.useCallback)(()=>{t.push("/wallet")},[t]),J=(0,s.useCallback)(e=>{t.push("/learn?topic=".concat(e))},[t]),X=(0,s.useMemo)(()=>o.filter(e=>e.name.toLowerCase().includes(g.toLowerCase())||e.symbol.toLowerCase().includes(g.toLowerCase())).sort((e,t)=>{let r=e[M.key],a=t[M.key];return r<a?"asc"===M.order?-1:1:r>a?"asc"===M.order?1:-1:0}),[o,g,M]),Q=(0,s.useMemo)(()=>{let e=o.reduce((e,t)=>e+t.volume,0),t=o.length>0?o.reduce((e,t)=>e+t.change,0)/o.length:0;if(z){var r;let t=z.totalProfitLoss&&z.totalPortfolioValue?(z.totalProfitLoss/z.totalPortfolioValue*100).toFixed(2):"0.00";return{portfolio:(null===(r=z.totalPortfolioValue)||void 0===r?void 0:r.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))||"0.00",change:t,volume:(e/1e9).toFixed(2)}}return{portfolio:"0.00",change:t.toFixed(2),volume:(e/1e9).toFixed(2)}},[o,z]);return c?(0,a.jsxs)("div",{className:"flex items-center justify-center h-screen dark:bg-gray-900",children:[(0,a.jsx)("div",{className:"w-32 h-32 border-b-4 border-indigo-600 rounded-full animate-spin"}),(0,a.jsx)("p",{className:"ml-4 text-xl text-indigo-600 dark:text-indigo-400",children:"Loading crypto data..."})]}):(0,a.jsx)("div",{className:"min-h-screen p-4 font-sans transition-colors duration-300 bg-gray-50 dark:bg-gray-900 md:p-8",children:(0,a.jsxs)("div",{className:"max-w-6xl mx-auto space-y-8",children:[(0,a.jsxs)("header",{className:"flex flex-col items-start justify-between space-y-4 md:flex-row md:items-center md:space-y-0",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-4xl font-extrabold tracking-tight text-gray-900 dark:text-white",children:["Welcome to ",(0,a.jsx)("span",{className:"text-indigo-600",children:"Luno"})]}),(0,a.jsx)("p",{className:"mt-1 text-lg text-gray-600 dark:text-gray-400",children:"Your trusted crypto trading platform"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("button",{onClick:()=>D(!C),className:"p-2 text-gray-600 transition-all bg-gray-100 rounded-full dark:text-gray-300 dark:bg-gray-700 hover:ring-2 ring-indigo-500",title:C?"Switch to Light Mode":"Switch to Dark Mode",children:C?(0,a.jsx)(b.Z,{className:"w-5 h-5 text-yellow-400"}):(0,a.jsx)(f.Z,{className:"w-5 h-5"})}),(0,a.jsxs)("button",{onClick:H,className:"flex items-center px-4 py-2 space-x-2 font-semibold text-white transition duration-150 bg-indigo-600 shadow-lg rounded-xl hover:bg-indigo-700",children:[(0,a.jsx)(l.Z,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:"Get Started"})]})]})]}),(0,a.jsx)(T,{className:"text-white border-0 bg-gradient-to-r from-indigo-600 to-purple-600",children:(0,a.jsxs)("div",{className:"flex flex-col items-center justify-between md:flex-row",children:[(0,a.jsxs)("div",{className:"mb-4 md:mb-0",children:[(0,a.jsx)("h2",{className:"mb-2 text-2xl font-bold",children:"Ready to start trading?"}),(0,a.jsx)("p",{className:"text-indigo-100",children:"Buy, sell, and manage your crypto assets securely with industry-leading tools."})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)("button",{onClick:W,className:"px-6 py-2 font-semibold text-indigo-600 transition duration-150 bg-white rounded-lg hover:bg-gray-50",children:"Buy Crypto"}),(0,a.jsx)("button",{onClick:G,className:"px-6 py-2 font-semibold text-indigo-600 transition duration-150 bg-white rounded-lg hover:bg-gray-50",children:"Sell Crypto"})]})]})}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(L,{currentTimeFrame:h,setTimeFrame:y})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 md:grid-cols-3",children:[(0,a.jsxs)(T,{icon:j.Z,children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:["Total Portfolio Value (",h,")"]}),(0,a.jsxs)("h1",{className:"mt-1 text-4xl font-extrabold text-gray-900 dark:text-white",children:["$",Q.portfolio]}),(0,a.jsxs)("p",{className:"text-md mt-2 flex items-center font-medium ".concat(parseFloat(Q.change)>=0?"text-green-500":"text-red-500"),children:[parseFloat(Q.change)>=0?(0,a.jsx)(v.Z,{className:"w-4 h-4 mr-1"}):(0,a.jsx)(N.Z,{className:"w-4 h-4 mr-1"}),Q.change,"% (",h,")"]})]}),(0,a.jsxs)(T,{icon:w.Z,children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:["Trading Volume (",h,")"]}),(0,a.jsxs)("h1",{className:"mt-1 text-4xl font-extrabold text-gray-900 dark:text-white",children:["$",Q.volume,"B"]}),(0,a.jsx)("p",{className:"mt-2 text-gray-500 text-md dark:text-gray-400",children:"Global activity metric"})]}),(0,a.jsxs)(T,{icon:l.Z,children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Available Fiat Balance"}),(0,a.jsxs)("h1",{className:"mt-1 text-4xl font-extrabold text-gray-900 dark:text-white",children:["$",(null==z?void 0:null===(e=z.balance)||void 0===e?void 0:e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}))||"0.00"]}),(0,a.jsxs)("button",{onClick:_,className:"flex items-center mt-2 font-medium text-indigo-500 transition duration-150 text-md hover:text-indigo-600",children:[(0,a.jsx)(l.Z,{className:"w-4 h-4 mr-1"})," Deposit / Withdraw"]})]})]}),(0,a.jsxs)(T,{title:"Top Crypto Assets",icon:p.Z,children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"h-2 w-2 rounded-full ".concat(V?"bg-green-500 animate-pulse":"bg-red-500")}),(0,a.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:V?"Live Updates Active":"Connecting to live data..."})]}),(0,a.jsx)("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:"Powered by Binance WebSocket"})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(k.Z,{className:"absolute w-5 h-5 text-gray-400 transform -translate-y-1/2 left-3 top-1/2 dark:text-gray-500"}),(0,a.jsx)("input",{type:"text",placeholder:"Search by name or symbol (e.g., BTC, Bitcoin)",value:g,onChange:e=>u(e.target.value),className:"w-full p-3 pl-10 text-gray-900 transition-shadow border border-gray-200 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-700 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500"})]})}),(0,a.jsxs)("div",{className:"grid items-center grid-cols-12 pb-2 mb-2 border-b-2 border-gray-100 dark:border-gray-700",children:[(0,a.jsx)("div",{className:"col-span-4 md:col-span-3",children:(0,a.jsx)(B,{column:"symbol",label:"Asset",currentSort:M,handleSort:$})}),(0,a.jsx)("div",{className:"col-span-3 text-left md:col-span-3",children:(0,a.jsx)(B,{column:"price",label:"Price",currentSort:M,handleSort:$})}),(0,a.jsx)("div",{className:"col-span-3 text-center md:col-span-2",children:(0,a.jsx)(B,{column:"change",label:"24h Change",currentSort:M,handleSort:$})}),(0,a.jsx)("div",{className:"hidden text-right md:block md:col-span-2",children:(0,a.jsx)(B,{column:"volume",label:"24h Volume",currentSort:M,handleSort:$})}),(0,a.jsx)("div",{className:"hidden col-span-2 text-right lg:block",children:(0,a.jsx)("span",{className:"text-xs font-semibold tracking-wider text-gray-500 uppercase dark:text-gray-400",children:"7d Chart"})})]}),(0,a.jsx)("div",{className:"divide-y divide-gray-100 dark:divide-gray-700",children:X.length>0?X.map(e=>(0,a.jsx)(P,{coin:e,isUpdating:O.has(e.symbol)},e.id)):(0,a.jsx)("div",{className:"py-8 text-center text-gray-500 dark:text-gray-400",children:V||0!==o.length?g?"No assets match your search criteria.":"No data is available.":"No live data is available. Check your network, the Binance API, or try refreshing the page."})}),(0,a.jsx)("p",{className:"mt-6 text-sm text-gray-500 dark:text-gray-400",children:"*Real-time data from Binance WebSocket. Updates live as prices change."})]}),(0,a.jsx)(T,{title:"Learn & Explore",icon:S.Z,children:(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-3",children:[(0,a.jsxs)("button",{onClick:()=>J("bitcoin"),className:"p-4 text-center transition-colors border border-gray-100 rounded-lg cursor-pointer dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-12 h-12 mx-auto mb-3 bg-indigo-100 rounded-full dark:bg-indigo-900/50",children:(0,a.jsx)(v.Z,{className:"w-6 h-6 text-indigo-600 dark:text-indigo-400"})}),(0,a.jsx)("h3",{className:"mb-2 font-semibold text-gray-900 dark:text-white",children:"What is Bitcoin?"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Learn the fundamentals of cryptocurrency and blockchain technology."})]}),(0,a.jsxs)("button",{onClick:()=>J("trading"),className:"p-4 text-center transition-colors border border-gray-100 rounded-lg cursor-pointer dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-12 h-12 mx-auto mb-3 bg-green-100 rounded-full dark:bg-green-900/50",children:(0,a.jsx)(w.Z,{className:"w-6 h-6 text-green-600 dark:text-green-400"})}),(0,a.jsx)("h3",{className:"mb-2 font-semibold text-gray-900 dark:text-white",children:"Trading Basics"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Understand buy/sell orders, market vs limit orders, and trading strategies."})]}),(0,a.jsxs)("button",{onClick:()=>J("security"),className:"p-4 text-center transition-colors border border-gray-100 rounded-lg cursor-pointer dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-700/50",children:[(0,a.jsx)("div",{className:"flex items-center justify-center w-12 h-12 mx-auto mb-3 bg-purple-100 rounded-full dark:bg-purple-900/50",children:(0,a.jsx)(l.Z,{className:"w-6 h-6 text-purple-600 dark:text-purple-400"})}),(0,a.jsx)("h3",{className:"mb-2 font-semibold text-gray-900 dark:text-white",children:"Security Guide"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Keep your account safe with 2FA, secure passwords, and best practices."})]})]})})]})})}B.displayName="SortButton";let Z=e=>{let{title:t,children:r,className:s=""}=e;return(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6 ".concat(s),children:[t&&(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:t}),r]})},z=e=>{let{status:t}=e;return(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat({pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"}[t]),children:t})};var U=()=>{let{user:e}=(0,A.a)(),[t,r]=(0,s.useState)([]),[i,l]=(0,s.useState)(!0),[n,o]=(0,s.useState)(null),d=(0,s.useCallback)(async()=>{if(e&&e.accessToken)try{let t=await fetch("/api/admin/requests",{headers:{Authorization:"Bearer ".concat(e.accessToken)}});if(t.ok){let e=await t.json();r(e.requests||[])}}catch(e){console.error("Error fetching requests",e)}finally{l(!1)}},[e]);(0,s.useEffect)(()=>{d()},[d]);let c=(0,s.useCallback)(async(t,r,a)=>{if(e&&e.accessToken){o(t);try{(await fetch("/api/admin/requests",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.accessToken)},body:JSON.stringify({requestId:t,action:r,reason:a})})).ok?(await d(),alert("Request ".concat(r,"d successfully"))):alert("Failed to ".concat(r," request"))}catch(e){alert("Error ".concat(r,"ing request"))}finally{o(null)}}},[e,d]);return i?(0,a.jsx)("p",{children:"Loading transaction requests..."}):(0,a.jsx)(Z,{title:"Transaction Requests",children:(0,a.jsx)("div",{className:"space-y-4",children:0===t.length?(0,a.jsx)("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"No pending requests"}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,a.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"User"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Type"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Amount"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:t.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.username}),(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"text-sm font-medium capitalize ".concat("deposit"===e.type?"text-green-600 dark:text-green-400":"text-orange-600 dark:text-orange-400"),children:e.type})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:["$",e.amount.toFixed(2)]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)(z,{status:e.status.toLowerCase()})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:"pending"===e.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>c(e.id,"approve"),disabled:n===e.id,className:"text-green-600 dark:text-green-400 hover:text-green-900 dark:hover:text-green-300 mr-3 disabled:opacity-50",children:"Approve"}),(0,a.jsx)("button",{onClick:()=>{let t=prompt("Enter rejection reason:");t&&c(e.id,"reject",t)},disabled:n===e.id,className:"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300 disabled:opacity-50",children:"Reject"})]})})]},e.id))})]})})})})};let I=e=>{let{title:t,children:r,className:s=""}=e;return(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 shadow-md rounded-lg p-6 ".concat(s),children:[t&&(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:t}),r]})},R=e=>{let{status:t}=e;return(0,a.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full ".concat({active:"bg-green-100 text-green-800",inactive:"bg-yellow-100 text-yellow-800",banned:"bg-red-100 text-red-800"}[t]),children:t})};var O=()=>{let{user:e}=(0,A.a)(),[t,r]=(0,s.useState)([]),[i,l]=(0,s.useState)(!0),n=(0,s.useCallback)(async()=>{if(e&&e.accessToken)try{let t=await fetch("/api/admin/users",{headers:{Authorization:"Bearer ".concat(e.accessToken)}});if(t.ok){let e=await t.json();r(e.users||[])}}catch(e){console.error("Error fetching users",e)}finally{l(!1)}},[e]);(0,s.useEffect)(()=>{n()},[n]);let o=(0,s.useCallback)(async(t,a)=>{if(e&&e.accessToken)try{(await fetch("/api/admin/users",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.accessToken)},body:JSON.stringify({userId:t,status:a})})).ok?(r(e=>e.map(e=>e.id===t?{...e,status:a}:e)),alert("User status updated to ".concat(a))):alert("Failed to update user status")}catch(e){alert("Error updating user status")}},[e]);return i?(0,a.jsx)("p",{children:"Loading users..."}):(0,a.jsx)(I,{title:"Detailed User Management",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("div",{className:"flex items-center space-x-4 mb-4",children:(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(k.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,a.jsx)("input",{type:"text",placeholder:"Search users...",className:"w-full pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,a.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"User"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Role"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Balance"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700",children:t.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.username}),(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("span",{className:"text-sm text-gray-900 dark:text-white",children:e.role})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)(R,{status:e.status})}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-white",children:["$",e.balance.toFixed(2)]}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:[(0,a.jsx)("button",{onClick:()=>o(e.id,"active"===e.status?"inactive":"active"),className:"text-indigo-600 dark:text-indigo-400 hover:text-indigo-900 dark:hover:text-indigo-300 mr-3",children:"Toggle Status"}),(0,a.jsx)("button",{onClick:()=>o(e.id,"banned"),className:"text-red-600 dark:text-red-400 hover:text-red-900 dark:hover:text-red-300",children:"Ban"})]})]},e.id))})]})})]})})},Y=r(543),K=r(6865);let V=()=>(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-50 dark:bg-gray-900",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-indigo-500"}),(0,a.jsx)("p",{className:"mt-4 text-lg font-medium text-gray-700 dark:text-gray-300",children:"Checking credentials..."})]});var q=e=>{let{children:t,requiredRole:r}=e,{isAuthenticated:s,isLoading:i,user:l}=(0,A.a)(),{addNotification:n}=(0,Y.l)();return i?(0,a.jsx)(V,{}):s?r&&(null==l?void 0:l.role)!==r?(n('Access Denied: You need the "'.concat(r,'" role to view this page.'),"error"),(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen bg-red-50 dark:bg-red-900/10 p-8",children:[(0,a.jsx)(K.Z,{className:"w-12 h-12 text-red-500 mb-4"}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-red-700 dark:text-red-400",children:"403 - Forbidden Access"}),(0,a.jsx)("p",{className:"mt-2 text-gray-700 dark:text-gray-300",children:"You do not have the necessary permissions to view this resource."}),(0,a.jsx)("a",{href:"/",className:"mt-6 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition",children:"Go to Dashboard"})]})):(0,a.jsx)(a.Fragment,{children:t}):(0,a.jsx)(c.default,{})},$=()=>{let[e,t]=(0,s.useState)([]),[r,i]=(0,s.useState)(!0),[l,n]=(0,s.useState)(null),{accessToken:o}=(0,A.a)();(0,s.useEffect)(()=>{(async()=>{if(!o){n("Authentication token not found."),i(!1);return}try{let e=await fetch("/api/admin/kyc",{headers:{Authorization:"Bearer ".concat(o)}});if(!e.ok)throw Error("Failed to fetch KYC requests");let r=await e.json();t(r.kycRequests)}catch(e){n(e.message)}finally{i(!1)}})()},[o]);let d=async(r,a)=>{let s="rejected"===a?prompt("Enter rejection reason:"):void 0;if("rejected"===a&&!s){alert("Rejection reason is required.");return}if(!o){n("Authentication token not found.");return}try{if(!(await fetch("/api/admin/kyc/".concat(r),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify({status:a,reason:s})})).ok)throw Error("Failed to ".concat(a," KYC request"));t(e.filter(e=>e.id!==r))}catch(e){n(e.message)}},c=async e=>{if(!e){alert("No file available");return}if(e.startsWith("http")){window.open(e,"_blank");return}if(!o){n("Authentication token not found.");return}try{let t=await fetch("/api/admin/files?path=".concat(encodeURIComponent(e)),{headers:{Authorization:"Bearer ".concat(o)}});if(!t.ok)throw Error("Failed to fetch file");let r=await t.json();window.open(r.downloadURL,"_blank")}catch(e){n(e.message)}};return r?(0,a.jsx)("p",{children:"Loading KYC requests..."}):l?(0,a.jsxs)("p",{children:["Error: ",l]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold mb-4",children:"KYC Management"}),0===e.length?(0,a.jsx)("p",{children:"No pending KYC requests."}):(0,a.jsx)("div",{className:"luno-card",children:(0,a.jsxs)("table",{className:"min-w-full w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"py-2",children:"User ID"}),(0,a.jsx)("th",{className:"py-2",children:"Full Name"}),(0,a.jsx)("th",{className:"py-2",children:"ID Type"}),(0,a.jsx)("th",{className:"py-2",children:"ID Number"}),(0,a.jsx)("th",{className:"py-2",children:"Selfie"}),(0,a.jsx)("th",{className:"py-2",children:"Document"}),(0,a.jsx)("th",{className:"py-2",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"border px-4 py-2",children:e.userId}),(0,a.jsx)("td",{className:"border px-4 py-2",children:e.fullName}),(0,a.jsx)("td",{className:"border px-4 py-2",children:e.idType}),(0,a.jsx)("td",{className:"border px-4 py-2",children:e.idNumber}),(0,a.jsx)("td",{className:"border px-4 py-2",children:e.selfieUrl?(0,a.jsx)("button",{onClick:()=>c(e.selfieUrl),className:"text-blue-500 hover:underline",children:"View"}):"N/A"}),(0,a.jsx)("td",{className:"border px-4 py-2",children:e.documentUrl?(0,a.jsx)("button",{onClick:()=>c(e.documentUrl),className:"text-blue-500 hover:underline",children:"View"}):"N/A"}),(0,a.jsxs)("td",{className:"border px-4 py-2",children:[(0,a.jsx)("button",{onClick:()=>d(e.id,"approved"),className:"bg-green-500 text-white px-2 py-1 rounded mr-2",children:"Approve"}),(0,a.jsx)("button",{onClick:()=>d(e.id,"rejected"),className:"bg-red-500 text-white px-2 py-1 rounded",children:"Reject"})]})]},e.id))})]})})]})},H=()=>(0,a.jsx)(q,{requiredRole:"admin",children:(0,a.jsxs)("div",{className:"p-4 space-y-8 bg-gray-50 dark:bg-gray-900 min-h-screen",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3 border-b border-gray-200 dark:border-gray-700 pb-4",children:[(0,a.jsx)(o.Z,{className:"w-8 h-8 text-indigo-600 dark:text-indigo-400"}),(0,a.jsx)("h1",{className:"text-4xl font-extrabold text-gray-900 dark:text-white",children:"System Admin Console"})]}),(0,a.jsx)(U,{}),(0,a.jsx)(O,{}),(0,a.jsx)($,{})]})}),W=r(3500),G=r(2489),_=r(1804),J=r(9397);let X=e=>{let{title:t,children:r,className:s=""}=e;return(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 ".concat(s),children:[t&&(0,a.jsx)("h2",{className:"mb-4 text-xl font-semibold text-gray-800 dark:text-gray-100",children:t}),r]})},Q=s.memo(e=>{var t;let{asset:r,currentPrice:s}=e,i=((null==r?void 0:r.quantity)||0)*(s||(null==r?void 0:r.averagePrice)||0),l=((null==r?void 0:r.quantity)||0)*((null==r?void 0:r.averagePrice)||0),n=i-l;return(0,a.jsxs)("div",{className:"grid items-center grid-cols-4 p-4 border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:(null==r?void 0:r.symbol)||"N/A"}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Avg $",null==r?void 0:null===(t=r.averagePrice)||void 0===t?void 0:t.toFixed(2)]})]}),(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)("div",{className:"text-sm text-gray-500 dark:text-gray-300",children:((null==r?void 0:r.quantity)||0).toFixed(8)})}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-sm text-gray-400",children:["$",(s||(null==r?void 0:r.averagePrice)||0).toFixed(2)]}),(0,a.jsxs)("div",{className:"font-medium dark:text-white",children:["$",i.toFixed(2)]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("div",{className:"text-sm ".concat(n>=0?"text-green-500":"text-red-500"),children:[n>=0?"+":"","$",n.toFixed(2)]}),(0,a.jsxs)("div",{className:"text-xs ".concat(n>=0?"text-green-400":"text-red-400"),children:[(l>0?n/l*100:0).toFixed(2),"%"]})]})]})});Q.displayName="AssetRow";let ee=e=>{let{transactionType:t,user:r,fetchData:i,onClose:l}=e,[n,o]=(0,s.useState)(""),d=async()=>{if(!n||0>=parseFloat(n)){alert("Please enter a valid amount");return}try{if(!r||!r.accessToken){alert("Please login first");return}let e=r.accessToken,a=await fetch("/api/portfolio",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)},body:JSON.stringify({type:t,amount:parseFloat(n)})}),s=await a.json();a.ok?(alert("".concat(t," of $").concat(parseFloat(n).toFixed(2)," successful!")),o(""),i(),l()):alert("".concat(t," failed: ").concat(s.error))}catch(e){alert("".concat(t," failed. Please try again."))}};return(0,a.jsxs)(X,{className:"mt-6 lg:col-span-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-2xl font-bold dark:text-white",children:"deposit"===t?"Deposit":"Withdraw"}),(0,a.jsx)("button",{onClick:l,className:"p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700",children:(0,a.jsx)(G.Z,{className:"w-6 h-6 text-gray-500 dark:text-gray-400"})})]}),(0,a.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1 text-sm font-medium text-gray-500 dark:text-gray-300",children:"Amount (USD)"}),(0,a.jsx)("input",{type:"number",value:n,onChange:e=>o(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg dark:border-gray-600 focus:ring-indigo-500 focus:border-indigo-500 dark:bg-gray-700 dark:text-white",placeholder:"Enter amount"})]}),(0,a.jsx)("div",{className:"flex space-x-4",children:(0,a.jsx)("button",{onClick:d,className:"flex-1 py-2 font-semibold text-white transition-colors bg-blue-600 rounded-lg hover:bg-blue-700",children:"Submit"})})]})]})};var et=e=>{var t;let{user:r}=e,[i,l]=(0,s.useState)(null),[n,o]=(0,s.useState)(!0),[d,c]=(0,s.useState)(null),[x,m]=(0,s.useState)(!1),[g,h]=(0,s.useState)(!1),[y,p]=(0,s.useState)(null),b=(0,s.useCallback)(async()=>{o(!0),c(null);let e=(null==r?void 0:r.accessToken)||null;if(!e)try{e=localStorage.getItem("accessToken")}catch(t){e=null}if(!e){o(!1),c("Please log in to view your assets.");return}try{let t={Authorization:"Bearer ".concat(e)},r=await (0,W.safeFetch)("/api/portfolio",{headers:t},2,700);r.ok?l(r.data):(console.error("Portfolio API safeFetch error:",r.error,"status:",r.status),c(r.error||"Failed to fetch portfolio data."))}catch(e){console.error("Unexpected error fetching portfolio:",e),c("An unexpected error occurred while fetching data. ".concat(String(e)))}finally{o(!1)}},[r]);(0,s.useEffect)(()=>{b()},[b]),(0,s.useEffect)(()=>{let e=()=>{b()};return window.addEventListener&&window.addEventListener("portfolio:updated",e),()=>{window.removeEventListener&&window.removeEventListener("portfolio:updated",e)}},[b]);let{prices:f}=F((null==i?void 0:null===(t=i.assets)||void 0===t?void 0:t.map(e=>e.symbol))||[]);return n?(0,a.jsx)("div",{className:"flex items-center justify-center h-screen dark:bg-gray-900",children:(0,a.jsx)("p",{className:"text-xl text-indigo-600 dark:text-indigo-400",children:"Loading portfolio..."})}):d?(0,a.jsx)("div",{className:"flex items-center justify-center h-screen dark:bg-gray-900",children:(0,a.jsx)("p",{className:"text-red-500 dark:text-red-400",children:d})}):i?(0,a.jsxs)("div",{className:"min-h-screen p-4 space-y-8 bg-gray-50 dark:bg-gray-900",children:[(0,a.jsxs)("h1",{className:"flex items-center text-4xl font-extrabold text-gray-900 dark:text-white",children:[(0,a.jsx)(_.Z,{className:"w-8 h-8 mr-3 text-indigo-500"}),"My Assets"]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3",children:[(0,a.jsxs)(X,{className:"lg:col-span-1",children:[(0,a.jsx)("h3",{className:"mb-4 text-lg font-semibold text-gray-800 dark:text-gray-100",children:"Portfolio Summary"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-lg bg-indigo-50 dark:bg-gray-700",children:[(0,a.jsx)(_.Z,{className:"w-6 h-6 text-indigo-600 dark:text-indigo-400"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-300",children:"Available Balance"}),(0,a.jsxs)("p",{className:"text-2xl font-bold dark:text-white",children:["$",((null==i?void 0:i.balance)||0).toFixed(2)]})]})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-300",children:"Total Portfolio Value"}),(0,a.jsxs)("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400",children:["$",((null==i?void 0:i.totalPortfolioValue)||0).toFixed(2)]})]})]})]}),(0,a.jsxs)(X,{title:"Your Holdings",className:"lg:col-span-2",children:[(0,a.jsxs)("div",{className:"grid grid-cols-3 p-3 text-xs font-semibold text-gray-500 uppercase border-b border-gray-200 dark:text-gray-400 dark:border-gray-700",children:[(0,a.jsx)("div",{children:"Asset"}),(0,a.jsx)("div",{className:"text-right",children:"Quantity"}),(0,a.jsx)("div",{className:"text-right",children:"Value"})]}),Array.isArray(null==i?void 0:i.assets)&&i.assets.length>0?i.assets.map(e=>{var t;let r=(null===(t=f.get(e.symbol))||void 0===t?void 0:t.price)||e.averagePrice||0;return(0,a.jsx)(Q,{asset:e,currentPrice:r},e.id)}):(0,a.jsx)("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:"No assets found."})]}),(0,a.jsx)(X,{title:"Transactions",className:"lg:col-span-3",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-4 md:grid-cols-2",children:[(0,a.jsxs)("button",{onClick:()=>{m(!x),h(!1)},className:"flex items-center justify-center px-4 py-3 font-semibold text-white transition-colors bg-green-600 rounded-lg hover:bg-green-700",children:[(0,a.jsx)(J.Z,{className:"w-5 h-5 mr-2"}),"Deposit"]}),(0,a.jsxs)("button",{onClick:()=>{h(!g),m(!1)},className:"flex items-center justify-center px-4 py-3 font-semibold text-white transition-colors bg-orange-600 rounded-lg hover:bg-orange-700",children:[(0,a.jsx)(u.Z,{className:"w-5 h-5 mr-2"}),"Withdraw"]})]})}),x&&(0,a.jsx)(ee,{transactionType:"deposit",user:r,fetchData:b,onClose:()=>m(!1)}),g&&(0,a.jsx)(ee,{transactionType:"withdraw",user:r,fetchData:b,onClose:()=>h(!1)})]})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-screen dark:bg-gray-900",children:(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No portfolio data available."})})},er=r(1671),ea=r(9322),es=r(1723),ei=r(2633),el=r(4558),en=r(1883),eo=r(9463),ed=r(2178),ec=r(6220),ex=r(6945),em=r(4009),eg=r(4647),eu=r(4120),eh=r(3002),ey=r(1222),ep=r(7914),eb=r(9419),ef=r(5828),ej=r(2391),ev=r(7818),eN=r(1154);let ew=(0,ei.b)()(el.UL),ek=[{id:"btc",name:"Bitcoin",symbol:"BTC"},{id:"eth",name:"Ethereum",symbol:"ETH"},{id:"sol",name:"Solana",symbol:"SOL"},{id:"bnb",name:"Binance Coin",symbol:"BNB"},{id:"ada",name:"Cardano",symbol:"ADA"},{id:"doge",name:"Dogecoin",symbol:"DOGE"},{id:"xrp",name:"Ripple",symbol:"XRP"},{id:"ltc",name:"Litecoin",symbol:"LTC"}],eS=ek.map(e=>e.symbol),eC=s.memo(e=>{let{title:t,children:r,className:s=""}=e;return(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 transition-colors duration-300 ".concat(s),children:[t&&(0,a.jsx)("h2",{className:"mb-4 text-xl font-semibold text-gray-800 dark:text-gray-100",children:t}),r]})});eC.displayName="Card";var eA=()=>{let[e,t]=(0,s.useState)(ek[0]),[i,l]=(0,s.useState)([]),{prices:n,isConnected:o}=F(eS),[d,c]=(0,s.useState)(0),[x,m]=(0,s.useState)(0),[h,y]=(0,s.useState)("BUY"),[p,b]=(0,s.useState)("MARKET"),[f,j]=(0,s.useState)(.01),[v,N]=(0,s.useState)(0),[w,k]=(0,s.useState)(1),[S,C]=(0,s.useState)("1h"),[A,E]=(0,s.useState)(!0),[T,D]=(0,s.useState)(null),[P,L]=(0,s.useState)(0),[B,M]=(0,s.useState)({show:!1,success:!1,message:""}),[Z,z]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let t=n.get(e.symbol);t&&i.length>0&&(c(t.price),m(t.change),l(e=>{let r=[...e],a=r[r.length-1],s={...a,close:t.price,high:Math.max(a.high,t.price),low:Math.min(a.low,t.price),volume:a.volume+t.volume};return r[r.length-1]=s,r}))},[n,e,i.length]),(0,s.useEffect)(()=>{let e=async()=>{try{let e=localStorage.getItem("accessToken");if(!e)return;let t=await fetch("/api/portfolio",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();L(e.balance||0)}}catch(e){console.error("Failed to fetch balance:",e)}};e();let t=setInterval(e,3e4);return()=>clearInterval(t)},[]),(0,s.useEffect)(()=>{d>0&&N(parseFloat(d.toFixed(2)))},[d,e]);let U=(0,s.useMemo)(()=>(0,en.Z)().options({windowSize:50}).merge((e,t)=>{e.ema50=t}).accessor(e=>e.ema50).stroke("#fa5252"),[]),I=(0,s.useMemo)(()=>(0,en.Z)().options({windowSize:20}).merge((e,t)=>{e.ema20=t}).accessor(e=>e.ema20).stroke("#82c91e"),[]),R=(0,s.useMemo)(()=>(0,eo.Z)().options({windowSize:14}).merge((e,t)=>{e.rsi=t}).accessor(e=>e.rsi),[]),O=(0,s.useMemo)(()=>(0,ed.Z)().options({fast:12,slow:26,signal:9}).merge((e,t)=>{e.macd=t}).accessor(e=>e.macd),[]),Y=(0,s.useMemo)(()=>{if(0===i.length)return[];let e=[...i];return O(e=R(e=I(e=U(e))))},[i,U,I,R,O]),{data:K,xScale:V,xAccessor:q,displayXAccessor:$}=(0,s.useMemo)(()=>(0,ec.S)().inputDateAccessor(e=>e.date),[])(Y),H=(0,s.useMemo)(()=>{if(0===K.length)return[0,0];let e=q(K[K.length-1]),t=Math.max(0,K.length-50);return[q(K[t]),e]},[K,q]),W=(0,s.useCallback)(e=>"$".concat(e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})),[]),G=(0,s.useCallback)(e=>e>=1e6?"".concat((e/1e6).toFixed(1),"M"):e>=1e3?"".concat((e/1e3).toFixed(0),"K"):e.toFixed(0),[]);(0,s.useEffect)(()=>{(async()=>{E(!0),D(null);let t=e.symbol.toUpperCase()+"USDT",{interval:a,limit:s}={"15m":{interval:"15m",limit:200},"15min":{interval:"15m",limit:200},"1h":{interval:"1h",limit:200},"1hour":{interval:"1h",limit:200},"4h":{interval:"4h",limit:200},"4hour":{interval:"4h",limit:200}}[String(S||"").trim().toLowerCase().replace(/\s+/g,"")]||{interval:"1h",limit:200},i="/api/binance?symbol=".concat(t,"&interval=").concat(a,"&limit=").concat(s);console.log("Fetching historical data:",i);try{let e=await (await Promise.resolve().then(r.bind(r,3500))).safeFetch(i,void 0,2,800);if(!e.ok)throw console.error("Historical API error (safeFetch):",e.error,"status:",e.status),Error(e.error||"API error ".concat(e.status));let t=e.data;if(!Array.isArray(t)||0===t.length){console.error("Historical klines not available or empty:",t),D("object"==typeof t&&(null==t?void 0:t.details)?"No historical data: ".concat(t.details):"No historical data available."),l([]),E(!1);return}let a=t.map(e=>({date:new Date(e.date),open:Number(e.open),high:Number(e.high),low:Number(e.low),close:Number(e.close),volume:Number(e.volume)}));if(l(a),a.length>0){let e=a[a.length-1].close;c(e),N(parseFloat(e.toFixed(2)))}}catch(e){console.error("Error fetching historical data:",e),D("Failed to load historical chart data. Please try again."),l([])}finally{E(!1)}})()},[e,S]);let _=(0,s.useCallback)(async()=>{if("BUY"===h&&P<=0){M({show:!0,success:!1,message:"Insufficient balance to place buy order."});return}if(Number.isNaN(f)||f<=0){M({show:!0,success:!1,message:"Enter a valid amount greater than 0."});return}if("LIMIT"===p&&(Number.isNaN(v)||v<=0)){M({show:!0,success:!1,message:"Enter a valid limit price greater than 0 for limit orders."});return}let t=localStorage.getItem("accessToken");if(!t){M({show:!0,success:!1,message:"You must be logged in to trade."});return}let r="MARKET"===p?d:v;if(!r||r<=0){M({show:!0,success:!1,message:"Execution price is invalid."});return}let a=f*r/Math.max(1,w);if("BUY"===h&&a>P){M({show:!0,success:!1,message:"Insufficient balance to cover margin for this buy order."});return}let s={symbol:e.symbol,type:h,orderType:p,quantity:f,price:r,leverage:w};z(!0);try{let e=await fetch("/api/orders",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(s)}),r=null;try{r=await e.json()}catch(e){r=null}if(e.ok&&r&&r.success){M({show:!0,success:!0,message:r.message||"Order placed successfully!"});try{window.dispatchEvent&&window.dispatchEvent(new CustomEvent("portfolio:updated"))}catch(e){}}else{let t=(null==r?void 0:r.error)||(null==r?void 0:r.message)||JSON.stringify(r)||"Status ".concat(e.status);M({show:!0,success:!1,message:"Failed to place order: ".concat(t)})}}catch(e){console.error("Error placing order:",e),M({show:!0,success:!1,message:"An unexpected error occurred: ".concat(String(e))})}finally{z(!1),setTimeout(()=>M(e=>({...e,show:!1})),5e3)}},[P,e.symbol,p,h,f,v,w,d]),J=x>=0,X="MARKET"===p?d:v,Q=f*X/w,ee=f*X*w;return A?(0,a.jsx)("div",{className:"flex items-center justify-center h-screen bg-gray-50 dark:bg-gray-900",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 border-4 border-indigo-600 border-t-transparent rounded-full animate-spin"}),(0,a.jsx)("p",{className:"text-xl font-semibold text-indigo-600 dark:text-indigo-400",children:"Loading Market Data..."})]})}):(0,a.jsxs)("div",{className:"min-h-screen p-4 space-y-6 bg-gray-50 dark:bg-gray-900 md:p-8",children:[B.show&&(0,a.jsxs)("div",{className:"flex items-center p-4 rounded-lg shadow-lg ".concat(B.success?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:[B.success?(0,a.jsx)(er.Z,{className:"w-5 h-5 mr-3"}):(0,a.jsx)(ea.Z,{className:"w-5 h-5 mr-3"}),(0,a.jsx)("p",{className:"font-medium",children:B.message})]}),T&&(0,a.jsxs)("div",{className:"flex items-center p-4 text-red-700 bg-red-100 border rounded-lg",children:[(0,a.jsx)(ea.Z,{className:"w-5 h-5 mr-3"}),(0,a.jsx)("p",{children:T})]}),!o&&!T&&(0,a.jsxs)("div",{className:"flex items-center p-4 text-yellow-700 bg-yellow-100 border rounded-lg",children:[(0,a.jsx)(ea.Z,{className:"w-5 h-5 mr-3"}),(0,a.jsx)("p",{children:"Connecting to real-time data feed..."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-3 xl:grid-cols-4",children:[(0,a.jsx)(eC,{className:"lg:col-span-2 xl:col-span-3",children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4 mb-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[ek.map(r=>(0,a.jsx)("button",{onClick:()=>t(r),className:"px-3 py-1.5 text-sm font-medium rounded-full ".concat(e.id===r.id?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700"),children:r.symbol},r.id)),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(es.Z,{className:"w-5 h-5 text-gray-500"}),["15m","1h","4h"].map(e=>(0,a.jsx)("button",{onClick:()=>C(e),className:"px-3 py-1.5 text-sm font-medium rounded-full ".concat(S===e?"bg-blue-600 text-white":"bg-gray-100 text-gray-700"),children:e},e))]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-3xl font-extrabold md:text-4xl dark:text-white",children:["$",d.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end text-sm font-medium ".concat(J?"text-green-500":"text-red-500"),children:[J?(0,a.jsx)(g.Z,{className:"w-4 h-4 mr-1"}):(0,a.jsx)(u.Z,{className:"w-4 h-4 mr-1"}),x.toFixed(2),"% (24h)"]})]})]}),(0,a.jsx)("div",{className:"w-full h-[650px]",children:i.length>0?(0,a.jsxs)(ew,{margin:{left:50,right:70,top:10,bottom:30},data:K,xScale:V,xAccessor:q,displayXAccessor:$,xExtents:H,ratio:1,seriesName:e.symbol,children:[(0,a.jsxs)(ex.k,{id:1,yExtents:e=>[e.high,e.low],height:300,children:[(0,a.jsx)(em.K,{axisAt:"bottom",orient:"bottom"}),(0,a.jsx)(eg.B,{axisAt:"right",orient:"right",tickFormat:W}),(0,a.jsx)(eu.i,{at:"right",orient:"right",displayFormat:W}),(0,a.jsx)(eh.$,{fill:e=>e.close>=e.open?"#0ECB81":"#F6465D",stroke:e=>e.close>=e.open?"#0ECB81":"#F6465D",wickStroke:e=>e.close>=e.open?"#0ECB81":"#F6465D"}),(0,a.jsx)(ey.e,{yAccessor:I.accessor(),strokeStyle:I.stroke()}),(0,a.jsx)(ey.e,{yAccessor:U.accessor(),strokeStyle:U.stroke()}),(0,a.jsx)(ep.X,{origin:[5,15]}),(0,a.jsx)(eb.I,{options:[{yAccessor:I.accessor(),type:"EMA",stroke:I.stroke(),windowSize:20},{yAccessor:U.accessor(),type:"EMA",stroke:U.stroke(),windowSize:50}]}),(0,a.jsx)(ef.M,{}),(0,a.jsx)(ej.M,{})]}),(0,a.jsxs)(ex.k,{id:2,yExtents:e=>e.volume,height:100,origin:(e,t)=>[0,t-200],children:[(0,a.jsx)(eg.B,{axisAt:"right",orient:"right",ticks:4,tickFormat:G}),(0,a.jsx)(eu.i,{at:"right",orient:"right",displayFormat:G}),(0,a.jsx)(ev.Q,{yAccessor:e=>e.volume,fillStyle:e=>e.close>e.open?"rgba(14, 203, 129, 0.5)":"rgba(246, 70, 93, 0.5)"})]}),(0,a.jsxs)(ex.k,{id:3,yExtents:e=>e.macd.macd,height:100,origin:(e,t)=>[0,t-100],children:[(0,a.jsx)(em.K,{axisAt:"bottom",orient:"bottom"}),(0,a.jsx)(eg.B,{axisAt:"right",orient:"right",ticks:2}),(0,a.jsx)(eN._,{at:"bottom",orient:"bottom",displayFormat:e=>new Date(e).toLocaleTimeString()}),(0,a.jsx)(eu.i,{at:"right",orient:"right",displayFormat:e=>e.toFixed(2)}),(0,a.jsx)(ev.Q,{yAccessor:e=>e.macd.histogram,fillStyle:e=>e.macd.histogram>0?"#82c91e":"#fa5252"}),(0,a.jsx)(ey.e,{yAccessor:e=>e.macd.macd,strokeStyle:"#228be6"}),(0,a.jsx)(ey.e,{yAccessor:e=>e.macd.signal,strokeStyle:"#fcc419"})]})]}):(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsx)("p",{className:"text-xl text-gray-400",children:T||"No chart data available."})})})]})}),(0,a.jsx)(eC,{title:"Trade ".concat(e.symbol),className:"lg:col-span-1",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsx)("button",{onClick:()=>y("BUY"),className:"px-4 py-2 text-sm font-bold text-center rounded-lg ".concat("BUY"===h?"bg-green-600 text-white":"bg-gray-700 text-gray-300"),children:"BUY"}),(0,a.jsx)("button",{onClick:()=>y("SELL"),className:"px-4 py-2 text-sm font-bold text-center rounded-lg ".concat("SELL"===h?"bg-red-600 text-white":"bg-gray-700 text-gray-300"),children:"SELL"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsx)("button",{onClick:()=>b("MARKET"),className:"px-4 py-2 text-xs font-medium rounded-md ".concat("MARKET"===p?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"),children:"Market"}),(0,a.jsx)("button",{onClick:()=>b("LIMIT"),className:"px-4 py-2 text-xs font-medium rounded-md ".concat("LIMIT"===p?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"),children:"Limit"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block mb-1 text-xs text-gray-400",children:["Amount (",e.symbol,")"]}),(0,a.jsx)("input",{type:"number",min:"0",step:"0.00000001",value:f,onChange:e=>{let t=parseFloat(e.target.value);j(Number.isFinite(t)?t:0)},className:"w-full p-2 text-sm text-white bg-gray-700 border border-gray-600 rounded-md"})]}),"LIMIT"===p&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block mb-1 text-xs text-gray-400",children:"Limit Price (USD)"}),(0,a.jsx)("input",{type:"number",min:"0",step:"0.01",value:v,onChange:e=>{let t=parseFloat(e.target.value);N(Number.isFinite(t)?t:0)},className:"w-full p-2 text-sm text-white bg-gray-700 border border-gray-600 rounded-md"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("label",{className:"block mb-1 text-xs text-gray-400",children:["Leverage: ",w,"x"]}),(0,a.jsx)("input",{type:"range",min:"1",max:"100",value:w,onChange:e=>k(parseInt(e.target.value)),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"})]}),(0,a.jsxs)("div",{className:"p-3 space-y-2 text-xs text-gray-300 bg-gray-900 rounded-lg",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Estimated Margin"}),(0,a.jsxs)("span",{children:["$",Q.toFixed(4)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Notional Value"}),(0,a.jsxs)("span",{children:["$",ee.toFixed(4)]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{children:"Available Balance"}),(0,a.jsxs)("span",{children:["$",P.toFixed(2)]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("button",{onClick:_,disabled:Z||f<=0||"LIMIT"===p&&v<=0||Q>P,className:"w-full py-3 text-sm font-bold text-white rounded-lg transition-colors ".concat(Z?"opacity-70 cursor-wait":"BUY"===h?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700"),children:Z?"Placing order...":"Place ".concat(h," Order")}),f<=0&&(0,a.jsx)("p",{className:"mt-2 text-xs text-yellow-300",children:"Enter an amount greater than 0."}),"LIMIT"===p&&v<=0&&(0,a.jsx)("p",{className:"mt-2 text-xs text-yellow-300",children:"Enter a valid limit price."}),Q>P&&(0,a.jsx)("p",{className:"mt-2 text-xs text-yellow-300",children:"Estimated margin exceeds available balance."})]})]})})]})]})},eF=r(9388),eE=r(8930),eT=r(8842);let eD=e=>{let{title:t,children:r,className:s=""}=e;return(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 ".concat(s),children:[t&&(0,a.jsx)("h2",{className:"mb-4 text-xl font-semibold text-gray-800 dark:text-gray-100",children:t}),r]})},eP=e=>{var t;let{order:r,onClose:s}=e;return r?(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-gray-900 bg-opacity-75",children:(0,a.jsxs)(eD,{className:"w-full max-w-md duration-300 animate-in slide-in-from-bottom-2",children:[(0,a.jsxs)("h3",{className:"mb-4 text-2xl font-bold dark:text-white",children:["Order #",r.id," Details"]}),(0,a.jsxs)("ul",{className:"space-y-3 text-gray-700 dark:text-gray-300",children:[(0,a.jsx)(eL,{label:"Asset",value:r.symbol,highlight:"BUY"===r.type?"text-green-500":"text-red-500"}),(0,a.jsx)(eL,{label:"Side",value:r.type,highlight:"BUY"===r.type?"text-green-500":"text-red-500"}),(0,a.jsx)(eL,{label:"Order Type",value:r.orderType||"MARKET"}),(0,a.jsx)(eL,{label:"Amount",value:"".concat(r.quantity," ").concat(r.symbol)}),(0,a.jsx)(eL,{label:"Execution Price",value:"$".concat(r.price.toLocaleString("en-US",{minimumFractionDigits:2}))}),(0,a.jsx)(eL,{label:"Leverage",value:"".concat(r.leverage||1,"x")}),(0,a.jsx)(eL,{label:"Status",value:r.status,highlight:"PENDING"===r.status?"text-yellow-500":"FILLED"===r.status?"text-green-500":"text-red-500"}),(0,a.jsx)(eL,{label:"Date",value:new Date((null===(t=r.createdAt)||void 0===t?void 0:t.seconds)*1e3).toLocaleString()}),"FILLED"===r.status&&(0,a.jsx)(eL,{label:"P&L (USD)",value:"".concat(r.pnl>0?"+":"").concat(r.pnl.toFixed(2)),highlight:r.pnl>0?"text-green-500 font-bold":r.pnl<0?"text-red-500 font-bold":"font-bold"})]}),(0,a.jsx)("button",{onClick:s,className:"w-full py-2 mt-6 font-semibold text-white transition bg-indigo-600 rounded-lg hover:bg-indigo-700",children:"Close"})]})}):null},eL=e=>{let{label:t,value:r,highlight:s="text-gray-900 dark:text-white"}=e;return(0,a.jsxs)("li",{className:"flex items-center justify-between pb-1 border-b border-gray-100 dark:border-gray-700",children:[(0,a.jsx)("span",{className:"text-sm font-medium",children:t}),(0,a.jsx)("span",{className:"text-base font-semibold ".concat(s),children:r})]})},eB=e=>{var t;let{order:r,onCancel:i,onViewDetails:l}=e,n="BUY"===r.type,o,d,c="text-gray-400";switch(r.status){case"PENDING":o=es.Z,d="text-yellow-500 bg-yellow-100 dark:bg-yellow-900/50";break;case"FILLED":o=er.Z,d="text-green-500 bg-green-100 dark:bg-green-900/50",c=void 0!==r.pnl?r.pnl>0?"text-green-500":r.pnl<0?"text-red-500":"text-gray-400":"text-gray-400";break;case"CANCELLED":o=eF.Z,d="text-red-500 bg-red-100 dark:bg-red-900/50";break;default:o=es.Z,d="text-gray-500 bg-gray-100 dark:bg-gray-700"}return(0,a.jsxs)("div",{className:"grid items-center grid-cols-6 p-4 border-b border-gray-100 cursor-pointer dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700",onClick:()=>l(r),children:[(0,a.jsxs)("div",{className:"font-bold ".concat(n?"text-green-500":"text-red-500"),children:[r.type," (",r.orderType,")"]}),(0,a.jsxs)("div",{className:"font-medium text-gray-900 dark:text-white",children:[r.quantity," ",r.symbol]}),(0,a.jsxs)("div",{className:"text-gray-600 dark:text-gray-300",children:["@ $",r.price.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsxs)("div",{className:"flex items-center text-sm font-medium px-3 py-1 rounded-full ".concat(d),children:[s.createElement(o,{className:"w-4 h-4 mr-1"}),r.status]})}),(0,a.jsxs)("div",{className:"text-right",children:["FILLED"===r.status?(0,a.jsxs)("span",{className:"font-bold ".concat(c),children:[void 0!==r.pnl?(r.pnl>0?"+":"")+r.pnl.toFixed(2):"0.00"," USD"]}):(0,a.jsx)("span",{className:"text-gray-500",children:"--"}),(0,a.jsx)("p",{className:"mt-1 text-xs text-gray-400",children:new Date((null===(t=r.createdAt)||void 0===t?void 0:t.seconds)*1e3).toLocaleDateString()})]}),(0,a.jsx)("div",{className:"flex justify-end",children:"PENDING"===r.status&&(0,a.jsx)("button",{onClick:e=>{e.stopPropagation(),i(r.id)},className:"p-2 text-red-500 transition hover:text-red-700 dark:hover:text-red-400",title:"Cancel Order",children:(0,a.jsx)(eE.Z,{className:"w-4 h-4"})})})]})},eM=e=>{let{label:t,onClick:r,currentSort:s,sortKey:i,className:l=""}=e;return(0,a.jsxs)("button",{onClick:r,className:"flex items-center group ".concat(l),children:[t,(0,a.jsx)(eT.Z,{className:"w-3 h-3 ml-1 transition-opacity ".concat(s.key===i?"opacity-100":"opacity-40 group-hover:opacity-70")})]})};var eZ=()=>{let[e,t]=(0,s.useState)("PENDING"),[r,i]=(0,s.useState)([]),[l,n]=(0,s.useState)({key:"createdAt",direction:"descending"}),[o,d]=(0,s.useState)("All"),[c,x]=(0,s.useState)(null),[m,g]=(0,s.useState)(1),[u,h]=(0,s.useState)(!0);(0,s.useEffect)(()=>{(async()=>{try{let e=localStorage.getItem("token");if(!e){h(!1);return}let t=await fetch("/api/orders",{headers:{Authorization:"Bearer ".concat(e)}});if(t.ok){let e=await t.json();i(e.orders||[])}}catch(e){}finally{h(!1)}})()},[]);let y=(0,s.useMemo)(()=>["All",...Array.from(new Set(r.map(e=>e.symbol)))],[r]),b=e=>{let t="ascending";l.key===e&&"ascending"===l.direction&&(t="descending"),n({key:e,direction:t})},f=e=>{x(e)},j=(0,s.useMemo)(()=>{let t=r.filter(t=>t.status===e);return"All"!==o&&(t=t.filter(e=>e.symbol===o)),t.sort((e,t)=>{let r=e[l.key],a=t[l.key];return void 0===r||void 0===a?0:r<a?"ascending"===l.direction?-1:1:r>a?"ascending"===l.direction?1:-1:0}),t},[r,e,o,l]),v=Math.ceil(j.length/5),N=5*m,w=j.slice(N-5,N),k=(0,s.useCallback)(async e=>{if(window.confirm("Are you sure you want to cancel order #".concat(e,"?")))try{let t=localStorage.getItem("token");(await fetch("/api/orders",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify({orderId:e,action:"CANCEL"})})).ok?(i(t=>t.map(t=>t.id===e?{...t,status:"CANCELLED"}:t)),alert("Order #".concat(e," has been cancelled."))):alert("Failed to cancel order")}catch(e){alert("Error cancelling order")}},[]),S=e=>{e>0&&e<=v&&g(e)};return u?(0,a.jsxs)("div",{className:"flex items-center justify-center h-screen dark:bg-gray-900",children:[(0,a.jsx)("div",{className:"w-32 h-32 border-b-4 border-indigo-600 rounded-full animate-spin"}),(0,a.jsx)("p",{className:"ml-4 text-xl text-indigo-600 dark:text-indigo-400",children:"Loading orders..."})]}):(0,a.jsxs)("div",{className:"min-h-screen p-4 space-y-8 bg-gray-50 dark:bg-gray-900",children:[(0,a.jsx)("h1",{className:"text-4xl font-extrabold text-gray-900 dark:text-white",children:"Order History & Management"}),(0,a.jsxs)(eD,{title:"Order List",children:[(0,a.jsx)("div",{className:"flex p-1 mb-4 bg-gray-100 dark:bg-gray-700 rounded-xl",children:["PENDING","FILLED","CANCELLED"].map(s=>(0,a.jsxs)("button",{onClick:()=>{t(s),g(1)},className:"flex-1 py-2 text-md font-medium rounded-lg transition-all duration-200 ".concat(e===s?"bg-indigo-600 shadow text-white dark:bg-indigo-700 dark:text-white":"text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600"),children:[s,(0,a.jsx)("span",{className:"ml-2 text-xs px-2 py-0.5 rounded-full bg-indigo-50 dark:bg-gray-800 text-indigo-600 dark:text-indigo-400",children:r.filter(e=>e.status===s).length})]},s))}),(0,a.jsxs)("div",{className:"flex items-center mb-4 space-x-4",children:[(0,a.jsx)(p.Z,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),(0,a.jsx)("select",{value:o,onChange:e=>{d(e.target.value),g(1)},className:"p-2 border border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-700 dark:text-white",children:y.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsxs)("div",{className:"grid grid-cols-6 p-4 text-xs font-semibold text-gray-500 uppercase border-b border-gray-200 dark:text-gray-400 dark:border-gray-700",children:[(0,a.jsx)(eM,{onClick:()=>b("type"),label:"Type/Order",currentSort:l,sortKey:"type"}),(0,a.jsx)(eM,{onClick:()=>b("symbol"),label:"Asset/Amount",currentSort:l,sortKey:"symbol"}),(0,a.jsx)(eM,{onClick:()=>b("price"),label:"Price",currentSort:l,sortKey:"price"}),(0,a.jsx)("span",{className:"text-center",children:"Status"}),(0,a.jsx)(eM,{onClick:()=>b("pnl"),label:"P&L / Date",currentSort:l,sortKey:"pnl",className:"text-right"}),(0,a.jsx)("span",{className:"text-right",children:"Actions"})]}),w.length>0?w.map(e=>(0,a.jsx)(eB,{order:e,onCancel:k,onViewDetails:f},e.id)):(0,a.jsxs)("div",{className:"p-8 text-center text-gray-500 dark:text-gray-400",children:["No ","All"!==o?o:""," ",e.toLowerCase()," orders found."]})]}),v>1&&(0,a.jsxs)("div",{className:"flex items-center justify-between pt-4 mt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Page ",m," of ",v]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>S(m-1),disabled:1===m,className:"px-3 py-1 text-sm border border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-700 dark:text-white disabled:opacity-50",children:"Previous"}),(0,a.jsx)("button",{onClick:()=>S(m+1),disabled:m===v,className:"px-3 py-1 text-sm border border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-700 dark:text-white disabled:opacity-50",children:"Next"})]})]})]}),(0,a.jsx)(eP,{order:c,onClose:()=>x(null)})]})},ez=r(5201),eU=r(9897),eI=r(6337),eR=r(7689);let eO=e=>new Promise((t,r)=>{let a=new FileReader;a.readAsDataURL(e),a.onload=()=>{t(a.result.split(",")[1])},a.onerror=e=>r(e)});var eY=e=>{let{isOpen:t,onClose:r,onSubmit:i,s3Url:l,onApprove:n,onReject:d,isAdminView:c=!1}=e,[x,m]=(0,s.useState)(""),[g,u]=(0,s.useState)(""),[h,y]=(0,s.useState)(""),[p,b]=(0,s.useState)(null),[f,j]=(0,s.useState)(null),[v,N]=(0,s.useState)(null),[w,k]=(0,s.useState)(null),[S,C]=(0,s.useState)(""),[A,F]=(0,s.useState)(""),[E,T]=(0,s.useState)("passport"),[D,P]=(0,s.useState)(""),[L,B]=(0,s.useState)(!1),[M,Z]=(0,s.useState)(null),[z,U]=(0,s.useState)(""),[I,R]=(0,s.useState)("");if(!t)return null;let O=async e=>{if(e.preventDefault(),!i){Z("An unexpected error occurred. Please try again later.");return}if(!x.trim()||!g||!h.trim()||!D.trim()||!E){Z("Please fill all required fields (name, DOB, address, ID type and number).");return}if(!p){Z("Please upload your identification document.");return}if(!v){Z("Please upload your selfie image.");return}Z(null),B(!0);try{let e="",t="";p&&(e=await eO(p)),v&&(t=await eO(v)),await i({fullName:x,dateOfBirth:g,address:h,documentImage:e||void 0,selfieImage:t||void 0,idType:E||void 0,idNumber:D||void 0,phoneNumber:S||void 0,nationality:A||void 0}),r()}catch(e){Z("Submission failed: ".concat(e.message||"Please try again."))}finally{B(!1)}},Y=!!(x.trim()&&g&&h.trim()&&D.trim()&&E&&p&&v);return c?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"luno-card max-w-2xl m-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Review KYC Submission"}),(0,a.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,a.jsx)(G.Z,{size:24})})]}),l?(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("img",{src:l,alt:"KYC Document",className:"w-full h-auto max-h-96 object-contain rounded-md border border-gray-300 dark:border-gray-600"})}):(0,a.jsx)("p",{className:"text-center text-gray-500 dark:text-gray-400",children:"Document not available."}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"rejectionReason",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Rejection Reason (if rejecting)"}),(0,a.jsx)("textarea",{id:"rejectionReason",value:z,onChange:e=>U(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500",placeholder:"Provide a clear reason for rejection",rows:3})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"approvalReason",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Approval Reason (Optional)"}),(0,a.jsx)("textarea",{id:"approvalReason",value:I,onChange:e=>R(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500",placeholder:"Optionally, provide a reason for approval",rows:3})]}),M&&(0,a.jsx)("p",{className:"text-sm text-red-500 dark:text-red-400 mb-4",children:M}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,a.jsx)("button",{onClick:()=>{if(d){if(!z){Z("Rejection reason is required.");return}Z(null),d(z)}},className:"py-2 px-4 rounded-md text-sm font-semibold text-white bg-red-600 hover:bg-red-700",children:"Reject"}),(0,a.jsx)("button",{onClick:()=>{n&&n(I)},className:"py-2 px-4 rounded-md text-sm font-semibold text-white bg-green-600 hover:bg-green-700",children:"Approve"})]})]})}):(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"luno-card max-w-md m-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center",children:[(0,a.jsx)(o.Z,{className:"mr-3 text-indigo-500"}),"Identity Verification (KYC)"]}),(0,a.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,a.jsx)(G.Z,{size:24})})]}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-6",children:"To comply with regulations, we need to verify your identity. Please provide your full legal name and upload a government-issued ID."}),(0,a.jsxs)("form",{onSubmit:O,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"fullName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Full Legal Name"}),(0,a.jsx)("input",{type:"text",id:"fullName",value:x,onChange:e=>m(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500",placeholder:"John Doe"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"dateOfBirth",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Date of Birth"}),(0,a.jsx)("input",{type:"date",id:"dateOfBirth",value:g,onChange:e=>u(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Address"}),(0,a.jsx)("input",{type:"text",id:"address",value:h,onChange:e=>y(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500",placeholder:"123 Main St, Anytown, USA"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Identification Document"}),(0,a.jsx)("div",{className:"mt-1 flex flex-col items-center px-4 pt-3 pb-2 border-2 border-gray-300 dark:border-gray-600 border-dashed rounded-md",children:(0,a.jsxs)("div",{className:"space-y-2 text-center w-full",children:[(0,a.jsx)(eR.Z,{className:"mx-auto h-10 w-10 text-gray-400"}),(0,a.jsxs)("div",{className:"flex items-center justify-center gap-3",children:[(0,a.jsxs)("label",{htmlFor:"file-upload",className:"relative cursor-pointer bg-white dark:bg-gray-800 rounded-md font-medium text-indigo-600 dark:text-indigo-400 hover:text-indigo-500 px-3 py-2 border border-gray-100",children:[(0,a.jsx)("span",{children:"Upload document"}),(0,a.jsx)("input",{id:"file-upload",name:"file-upload",type:"file",className:"sr-only",onChange:e=>{let t=e.target.files?e.target.files[0]:null;if(t){if(t.size>10485760){Z("Document file is too large (max 10MB)"),b(null),j(null);return}if(!["image/png","image/jpeg","application/pdf"].includes(t.type)){Z("Unsupported document type. Use PNG/JPG/PDF"),b(null),j(null);return}b(t),j(t.type.startsWith("image/")?URL.createObjectURL(t):null),Z(null)}else b(null),j(null)}})]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"or drag and drop"})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-500",children:"PNG, JPG, PDF up to 10MB"}),p&&(0,a.jsx)("p",{className:"text-sm text-green-600 dark:text-green-400",children:p.name}),f&&(0,a.jsx)("img",{src:f,alt:"document preview",className:"mt-2 w-40 h-28 object-contain rounded-md border"})]})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Selfie (hold ID next to face)"}),(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)("input",{type:"file",accept:"image/*",onChange:e=>N(e.target.files?e.target.files[0]:null)}),v&&(0,a.jsx)("p",{className:"text-sm text-green-600 dark:text-green-400",children:v.name})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ID Type"}),(0,a.jsxs)("select",{value:E,onChange:e=>T(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md",children:[(0,a.jsx)("option",{value:"passport",children:"Passport"}),(0,a.jsx)("option",{value:"driving_license",children:"Driving License"}),(0,a.jsx)("option",{value:"national_id",children:"National ID"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"ID Number"}),(0,a.jsx)("input",{type:"text",value:D,onChange:e=>P(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Phone Number"}),(0,a.jsx)("input",{type:"text",value:S,onChange:e=>C(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md"})]}),(0,a.jsxs)("div",{className:"sm:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nationality"}),(0,a.jsx)("input",{type:"text",value:A,onChange:e=>F(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md"})]})]}),M&&(0,a.jsx)("p",{className:"text-sm text-red-500 dark:text-red-400",children:M}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"py-2 px-4 rounded-md text-sm font-semibold text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:L||!Y,className:"py-2 px-6 rounded-md text-sm font-semibold text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 flex items-center",children:L?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-3"}),"Submitting..."]}):"Submit for Verification"})]}),!Y&&(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"Required: name, date of birth, address, ID type & number, document and selfie."})]})]})})},eK=e=>{let{isOpen:t,onClose:r,onSubmit:i}=e,[l,n]=(0,s.useState)(""),[o,d]=(0,s.useState)(""),[c,x]=(0,s.useState)(""),[m,g]=(0,s.useState)(!1),[u,h]=(0,s.useState)(null);if(!t)return null;let y=async e=>{if(e.preventDefault(),o!==c){h("New passwords do not match.");return}if(o.length<6){h("Password must be at least 6 characters long.");return}h(null),g(!0);try{await i({currentPassword:l,newPassword:o})}catch(e){h(e.message||"An unexpected error occurred.")}finally{g(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-8 w-full max-w-md m-4",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white flex items-center",children:[(0,a.jsx)(eI.Z,{className:"mr-3 text-indigo-500"}),"Change Password"]}),(0,a.jsx)("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300",children:(0,a.jsx)(G.Z,{size:24})})]}),(0,a.jsxs)("form",{onSubmit:y,className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"currentPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Current Password"}),(0,a.jsx)("input",{type:"password",id:"currentPassword",value:l,onChange:e=>n(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"newPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"New Password"}),(0,a.jsx)("input",{type:"password",id:"newPassword",value:o,onChange:e=>d(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"confirmPassword",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Confirm New Password"}),(0,a.jsx)("input",{type:"password",id:"confirmPassword",value:c,onChange:e=>x(e.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-indigo-500"})]}),u&&(0,a.jsx)("p",{className:"text-sm text-red-500 dark:text-red-400",children:u}),(0,a.jsxs)("div",{className:"flex justify-end space-x-4",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"py-2 px-4 rounded-md text-sm font-semibold text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600",children:"Cancel"}),(0,a.jsx)("button",{type:"submit",disabled:m,className:"py-2 px-6 rounded-md text-sm font-semibold text-white bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-400 flex items-center",children:m?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-3"}),"Updating..."]}):"Update Password"})]})]})]})})};let eV=e=>{let{title:t,children:r,className:s=""}=e;return(0,a.jsxs)("div",{className:"luno-card ".concat(s),children:[t&&(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-800 dark:text-gray-100",children:t}),r]})},eq=e=>{let{label:t,value:r,icon:s,action:i}=e;return(0,a.jsxs)("div",{className:"flex items-start py-2 border-b border-gray-100 dark:border-gray-700 last:border-b-0",children:[(0,a.jsx)(s,{className:"w-5 h-5 mr-3 mt-1 text-indigo-500 shrink-0"}),(0,a.jsxs)("div",{className:"flex flex-col flex-grow",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:t}),(0,a.jsx)("span",{className:"text-base font-semibold text-gray-900 dark:text-white",children:r})]}),i&&(0,a.jsx)("div",{className:"ml-4",children:i})]})},e$=e=>{let{label:t,icon:r,color:s,onClick:i}=e;return(0,a.jsxs)("button",{onClick:i,className:"flex items-center justify-center space-x-2 py-2 px-4 rounded-lg font-semibold transition-colors duration-200 border ".concat(s.includes("indigo")?"text-indigo-600 border-indigo-100 bg-indigo-50 hover:bg-indigo-100 dark:bg-indigo-900/50 dark:border-indigo-900 dark:text-indigo-300":"text-gray-600 border-gray-200 bg-white hover:bg-gray-50 dark:bg-gray-700 dark:border-gray-600 dark:text-gray-300"),children:[(0,a.jsx)(r,{className:"w-5 h-5"}),(0,a.jsx)("span",{children:t})]})};var eH=()=>{let{user:e}=(0,A.a)(),{kycStatus:t,checkKycStatus:r}=(0,ez.x)(),{addNotification:i}=(0,Y.l)(),[n,c]=(0,s.useState)(null),[x,m]=(0,s.useState)([]),[g,u]=(0,s.useState)(!1),[h,y]=(0,s.useState)(!1),[p,b]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/activity-log");if(e.ok){let t=await e.json();m(t)}}catch(e){console.error("Error fetching activity log:",e)}};(async()=>{try{let e=await fetch("/api/profile");if(e.ok){let t=await e.json();c(t)}}catch(e){console.error("Error fetching profile data:",e)}})(),e()},[]);let f=async()=>{try{let e=await fetch("/api/activity-log?full=true");if(e.ok){let t=await e.json();m(t),u(!0)}}catch(e){console.error("Error fetching full activity log:",e)}},j=async t=>{if(!e||!e.accessToken){i("Authentication error. Please log in again.","error");return}y(!1);try{let a=await fetch("/api/kyc",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.accessToken)},body:JSON.stringify(t)});if(a.ok)i("KYC documents submitted successfully!","success"),await r();else{let e=await a.json();i(e.error||"KYC submission failed.","error")}}catch(e){console.error("KYC submission error:",e),i("An error occurred during submission.","error")}},v=async e=>{let t=await fetch("/api/auth/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).message||"Failed to change password");i("Password changed successfully!","success"),b(!1)},N={name:(null==e?void 0:e.username)||"N/A",email:(null==e?void 0:e.email)||"N/A",tier:(null==n?void 0:n.tier)||"N/A",feeDiscount:(null==n?void 0:n.feeDiscount)||"N/A",since:(null==n?void 0:n.since)||"N/A",securityScore:(null==n?void 0:n.securityScore)||"N/A"},k=e=>{"View Full Activity Log"===e?f():alert("Simulating action: ".concat(e))},S=e=>{let t=new Date(e),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0"),s=t.getFullYear();return"".concat(r,"/").concat(a,"/").concat(s)};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(eY,{isOpen:h,onClose:()=>y(!1),onSubmit:j}),(0,a.jsx)(eK,{isOpen:p,onClose:()=>b(!1),onSubmit:v}),(0,a.jsxs)("div",{className:"p-4 space-y-8 bg-gray-50 dark:bg-gray-900 min-h-screen",children:[(0,a.jsx)("h1",{className:"text-4xl font-extrabold text-gray-900 dark:text-white",children:"Account Settings"}),(0,a.jsxs)("div",{className:"flex items-center space-x-6 pb-4 border-b border-gray-200 dark:border-gray-700",children:[(0,a.jsx)("div",{className:"w-20 h-20 rounded-full bg-indigo-500 flex items-center justify-center text-white text-3xl font-bold border-4 border-white dark:border-gray-800 shadow-md",children:N.name.charAt(0)}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:N.name}),(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:N.email})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsx)(eV,{title:"Profile Information",className:"lg:col-span-2",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,a.jsx)(eq,{label:"Name",value:N.name,icon:d.Z}),(0,a.jsx)(eq,{label:"Email",value:N.email,icon:eU.Z}),(0,a.jsx)(eq,{label:"Member Since",value:N.since,icon:w.Z}),(0,a.jsx)(eq,{label:"Verification Status",value:t,icon:er.Z,action:"Verified"===t?(0,a.jsx)("span",{className:"px-3 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300",children:"Verified"}):"Pending Review"===t?(0,a.jsx)("span",{className:"px-3 py-1 text-xs font-semibold rounded-full bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300",children:"Pending"}):"Rejected"===t?(0,a.jsx)("button",{onClick:()=>y(!0),className:"px-3 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300 hover:bg-red-200",children:"Retry KYC"}):(0,a.jsx)("button",{onClick:()=>y(!0),className:"px-3 py-1 text-xs font-semibold rounded-full bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-300 hover:bg-indigo-200",children:"Verify KYC"})})]})}),(0,a.jsx)(eV,{title:"Trading Status",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"p-4 bg-indigo-50 dark:bg-indigo-900/50 rounded-lg flex flex-col",children:[(0,a.jsx)("p",{className:"font-semibold text-indigo-700 dark:text-indigo-300",children:"Trading Tier"}),(0,a.jsx)("span",{className:"text-2xl font-extrabold text-indigo-800 dark:text-indigo-400",children:N.tier})]}),(0,a.jsxs)("div",{className:"p-4 bg-teal-50 dark:bg-teal-900/50 rounded-lg flex justify-between items-center",children:[(0,a.jsxs)("p",{className:"font-semibold text-teal-700 dark:text-teal-300 flex items-center",children:[(0,a.jsx)(l.Z,{className:"w-5 h-5 mr-2"}),"Fee Discount"]}),(0,a.jsx)("span",{className:"font-bold text-xl text-teal-700 dark:text-teal-300",children:N.feeDiscount})]})]})})]}),(0,a.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:(0,a.jsx)(eV,{title:"Security & Access",className:"lg:col-span-3",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"p-4 border border-yellow-200 dark:border-yellow-700 bg-yellow-50 dark:bg-yellow-900/30 rounded-lg space-y-2",children:[(0,a.jsxs)("div",{className:"flex items-center text-yellow-700 dark:text-yellow-400 font-bold",children:[(0,a.jsx)(o.Z,{className:"w-5 h-5 mr-2"}),"Current Security Posture: ",(0,a.jsx)("span",{className:"ml-1",children:N.securityScore})]}),(0,a.jsx)("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:"2FA is **Enabled**."})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(e$,{label:"Manage 2FA",icon:eI.Z,color:"indigo",onClick:()=>k("Manage 2FA")}),(0,a.jsx)(e$,{label:"Change Password",icon:eU.Z,color:"gray",onClick:()=>b(!0)})]})]})})}),(0,a.jsxs)(eV,{title:"Recent Account Activity",children:[(0,a.jsx)("div",{className:"space-y-3 text-sm",children:x.map(e=>(0,a.jsxs)("div",{className:"p-3 border-l-4 border-indigo-500 dark:border-indigo-600 rounded flex flex-col sm:flex-row justify-between hover:bg-gray-50 dark:hover:bg-gray-700/50 transition",children:[(0,a.jsxs)("div",{className:"flex items-center mb-1 sm:mb-0",children:[(0,a.jsx)(w.Z,{className:"w-4 h-4 mr-3 text-indigo-500 shrink-0"}),(0,a.jsxs)("p",{className:"font-semibold text-gray-900 dark:text-white",children:[e.action," ",(0,a.jsxs)("span",{className:"text-gray-500 dark:text-gray-400 font-normal ml-2 text-xs",children:["(",S(e.time),")"]})]})]}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 sm:text-right",children:e.details})]},e.id))}),!g&&(0,a.jsx)("div",{className:"mt-4 text-center",children:(0,a.jsx)("button",{onClick:()=>k("View Full Activity Log"),className:"text-sm text-indigo-600 dark:text-indigo-400 hover:underline font-semibold",children:"View Full Activity Log"})})]})]})]})},eW=r(3578),eG=e=>{let{onVerify:t}=e,{kycStatus:r,isLoading:s}=(0,ez.x)();return s?(0,a.jsxs)("div",{className:"luno-card flex flex-col items-center justify-center h-full p-8 text-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-t-4 border-gray-200 rounded-full animate-spin border-t-blue-600"}),(0,a.jsx)("p",{className:"mt-4 text-lg font-semibold text-gray-700 dark:text-gray-300",children:"Checking KYC Status..."})]}):(0,a.jsxs)("div",{className:"luno-card flex flex-col items-center justify-center h-full p-8 text-center bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800",children:[(0,a.jsx)(eW.Z,{className:"w-16 h-16 text-red-500 dark:text-red-400 mb-6"}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Identity Verification Required"}),(0,a.jsx)("p",{className:"max-w-md text-gray-600 dark:text-gray-400 mb-6",children:"To access trading features, you must complete our Know Your Customer (KYC) identity verification process. This is a one-time process required for security and compliance."}),(0,a.jsxs)("p",{className:"text-sm font-semibold text-red-600 dark:text-red-400 mb-6",children:["Your Current Status: ",r]}),(0,a.jsx)("button",{onClick:t,className:"px-8 py-3 font-semibold text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:opacity-50",disabled:"Pending Review"===r,children:"Pending Review"===r?"Verification Pending...":"Start KYC Verification"})]})},e_=r(8293),eJ=r(7692);let eX=[{name:"KYC Management",page:"AdminKYC",icon:r(4286).Z}],eQ=e=>{let{isActive:t}=e;return(0,a.jsxs)("div",{className:"flex items-center overflow-hidden whitespace-nowrap",children:[(0,a.jsxs)("div",{className:"relative w-8 h-8 ".concat(t?"mr-2":""," shrink-0"),children:[(0,a.jsx)("div",{className:"absolute inset-0 rounded-full bg-blue-600 opacity-60"}),(0,a.jsx)("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 rounded-full bg-white w-1/2 h-1/2"})]}),(0,a.jsx)("h1",{className:"text-3xl font-extrabold text-gray-900 dark:text-white transition-opacity duration-300 ".concat(t?"opacity-100":"opacity-0"," overflow-hidden"),children:"LUNO"})]})};var e0=e=>{let{navItems:t,currentPage:r,setCurrentPage:i}=e,[l,n]=(0,s.useState)(!1),[o,d]=(0,s.useState)(!0),[c,x]=(0,s.useState)(!1),{user:m,logout:g}=(0,A.a)(),{theme:u}=(0,Y.F)();(0,s.useEffect)(()=>{let e=e=>{let t=document.getElementById("sidebar"),r=document.getElementById("sidebar-toggle");t&&!t.contains(e.target)&&r&&!r.contains(e.target)&&l&&n(!1)};return l&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[l]);let h=e=>{i(e),n(!1)},y=l||!o||c,p=(null==m?void 0:m.roles.includes("admin"))?[...t,...eX]:t;return(0,a.jsxs)(a.Fragment,{children:["\xa0 \xa0 \xa0 ","\xa0 \xa0 \xa0 ",(0,a.jsxs)("button",{id:"sidebar-toggle",onClick:()=>n(!l),className:"fixed top-4 left-4 z-40 md:hidden bg-blue-600 text-white p-3 rounded-full shadow-xl",children:["\xa0 \xa0 \xa0 \xa0 ",l?(0,a.jsx)(G.Z,{size:20}):(0,a.jsx)(e_.Z,{size:20}),"\xa0 \xa0 \xa0 "]}),"\xa0 \xa0 \xa0 ","\xa0 \xa0 \xa0 ",l&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-40 z-20 md:hidden",onClick:()=>n(!1)}),"\xa0 \xa0 ","\xa0 \xa0 ",(0,a.jsxs)("nav",{id:"sidebar",onMouseEnter:()=>o&&x(!0),onMouseLeave:()=>o&&x(!1),className:"fixed left-0 top-0 bottom-0 bg-white dark:bg-gray-900 p-6 flex flex-col justify-between z-30 transform transition-all duration-300 ease-in-out shadow-lg dark:shadow-none border-r border-gray-100 dark:border-gray-800\n\xa0 \xa0 \xa0 \xa0 \xa0 \xa0 ".concat(l?"translate-x-0":"-translate-x-full"," md:translate-x-0 overflow-x-hidden"),style:{width:y?"16rem":"5rem"},children:["\xa0 \xa0 \xa0 \xa0 ",(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex items-center mb-10 transition-all duration-300 justify-center",children:(0,a.jsx)(eQ,{isActive:y})}),(0,a.jsx)("ul",{className:"space-y-2",children:p.map(e=>(0,a.jsx)("li",{children:(0,a.jsxs)("button",{onClick:()=>h(e.page),className:"nav-link w-full text-left flex items-center p-3 rounded-lg transition-all duration-300\n".concat(y?"justify-start":"justify-center","\n").concat(r===e.page?"bg-blue-600 text-white shadow-md":"text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 hover:text-gray-900 dark:hover:text-white"),children:[(0,a.jsx)(e.icon,{className:"w-6 h-6 shrink-0 transition-all duration-300 ".concat(y?"mr-3":"mx-auto")}),(0,a.jsx)("span",{className:"text-base font-semibold whitespace-nowrap transition-all duration-300 ".concat(y?"opacity-100 max-w-full":"opacity-0 max-w-0"," overflow-hidden"),children:e.name})]})},e.name))}),"\xa0 \xa0 \xa0 \xa0 "]}),"\xa0 \xa0 \xa0 \xa0 ","\xa0 \xa0 \xa0 \xa0 ",(0,a.jsxs)("div",{className:"pt-4 border-t border-gray-100 dark:border-gray-800",children:["\xa0 \xa0 \xa0 \xa0 \xa0 \xa0",(0,a.jsxs)("button",{onClick:()=>h("Profile"),className:"w-full flex items-center p-3 rounded-lg transition-all duration-300 hover:bg-gray-100 dark:hover:bg-gray-800\n                    ".concat(y?"justify-start":"justify-center"),children:[(0,a.jsx)("div",{className:"w-8 h-8 rounded-full bg-blue-500 dark:bg-indigo-500 flex items-center justify-center text-white font-bold text-sm shrink-0",children:(null==m?void 0:m.username)?m.username.charAt(0).toUpperCase():"?"}),(0,a.jsxs)("div",{className:"ml-3 overflow-hidden transition-opacity duration-300 ".concat(y?"opacity-100":"opacity-0"," whitespace-nowrap text-left"),children:[(0,a.jsx)("p",{className:"text-sm font-semibold text-gray-900 dark:text-white truncate",children:(null==m?void 0:m.username)||"Guest"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"View Profile"})]})]}),(0,a.jsxs)("button",{onClick:g,className:"w-full mt-2 flex items-center p-3 rounded-lg text-gray-500 dark:text-gray-400 hover:text-red-600 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors\n                                ".concat(y?"justify-start":"justify-center"),title:"Logout",children:[(0,a.jsx)(eJ.Z,{className:"w-6 h-6 shrink-0 transition-all duration-300 ".concat(y?"mr-3":"mx-auto")}),(0,a.jsx)("span",{className:"text-base font-semibold transition-all duration-300 ".concat(y?"opacity-100 max-w-full":"opacity-0 max-w-0"," overflow-hidden"),children:"Logout"})]}),"\xa0 \xa0 \xa0 \xa0 "]}),"\xa0 \xa0 "]}),"\xa0 \xa0 "]})},e2=()=>{let{user:e,logout:t}=(0,A.a)(),r=(0,m.useRouter)(),[i,l]=(0,s.useState)(!1);return(0,a.jsxs)("header",{className:"bg-white dark:bg-gray-800 shadow-sm border-b border-gray-200 dark:border-gray-700 px-4 py-3 flex justify-between items-center",children:[(0,a.jsx)("div",{className:"flex items-center space-x-4",children:(0,a.jsx)("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:"TradePath Crypto"})}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-700 dark:text-gray-300",children:["Welcome, ",null==e?void 0:e.username]}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsxs)("button",{onClick:()=>l(!i),className:"flex items-center space-x-2 text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white",children:[(0,a.jsx)(d.Z,{className:"w-5 h-5"}),(0,a.jsx)(y.Z,{className:"w-4 h-4"})]}),i&&(0,a.jsx)("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-md shadow-lg py-1 z-10 border border-gray-200 dark:border-gray-700",children:(0,a.jsx)("button",{onClick:()=>{t(),r.push("/login")},className:"block px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 w-full text-left",children:"Logout"})})]})]})]})},e1=()=>{let{user:e,isLoading:t}=(0,A.a)(),{kycStatus:r,isLoading:m}=(0,ez.x)(),[g,u]=(0,s.useState)("Home"),h=()=>{u("Profile")},y=(0,s.useMemo)(()=>[{name:"Home",page:"Home",icon:i.Z},{name:"Assets",page:"Assets",icon:l.Z},{name:"Market",page:"Market",icon:n.Z},{name:"Orders",page:"Orders",icon:o.Z},{name:"Profile",page:"Profile",icon:d.Z},...(null==e?void 0:e.isAdmin)?[{name:"Admin",page:"Admin",icon:o.Z}]:[]],[null==e?void 0:e.isAdmin]);return t||m?(0,a.jsx)("div",{className:"flex items-center justify-center h-screen bg-gray-100 dark:bg-gray-900",children:(0,a.jsx)("div",{className:"w-16 h-16 border-4 border-t-4 border-gray-200 rounded-full animate-spin border-t-blue-600"})}):e?(0,a.jsxs)("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[(0,a.jsx)(e0,{navItems:y,currentPage:g,setCurrentPage:u}),(0,a.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden",children:[(0,a.jsx)(e2,{}),(0,a.jsx)("main",{className:"flex-1 overflow-x-hidden overflow-y-auto bg-gray-200 dark:bg-gray-800",children:(0,a.jsx)("div",{className:"container mx-auto px-6 py-8",children:(()=>{let t=r.startsWith("Verified");if(["Assets","Market","Orders"].includes(g)&&!t)return(0,a.jsx)(eG,{onVerify:h});switch(g){case"Home":default:return(0,a.jsx)(M,{});case"Assets":return(0,a.jsx)(et,{user:e});case"Market":return(0,a.jsx)(eA,{});case"Orders":return(0,a.jsx)(eZ,{});case"Profile":return(0,a.jsx)(eH,{});case"Admin":return(0,a.jsx)(H,{});case"AdminKYC":return(0,a.jsx)($,{});case"Login":return(0,a.jsx)(c.default,{});case"Signup":return(0,a.jsx)(x.default,{})}})()})})]})]}):"Login"===g?(0,a.jsx)(c.default,{}):"Signup"===g?(0,a.jsx)(x.default,{}):(0,a.jsx)(c.default,{})}},543:function(e,t,r){"use strict";r.d(t,{default:function(){return b},l:function(){return h},F:function(){return m}});var a=r(7437),s=r(2265),i=r(1671),l=r(6865),n=r(4766);let o=["UNSAFE_componentWillMount","UNSAFE_componentWillReceiveProps","findDOMNode is deprecated"];{let e=console.error,t=console.warn,r=e=>{for(let t of e)if("string"==typeof t){for(let e of o)if(t.includes(e))return!0}return!1};console.warn=function(){for(var e=arguments.length,a=Array(e),s=0;s<e;s++)a[s]=arguments[s];r(a)||t.apply(console,a)},console.error=function(){for(var t=arguments.length,a=Array(t),s=0;s<t;s++)a[s]=arguments[s];r(a)||e.apply(console,a)}}var d=r(243),c=r(5201);let x=(0,s.createContext)(void 0),m=()=>{let e=(0,s.useContext)(x);if(!e)throw Error("useTheme must be used within a ThemeProvider");return e},g=e=>{let{children:t}=e,[r,i]=(0,s.useState)("light"),l=()=>{i(e=>{let t="light"===e?"dark":"light";return document.documentElement.classList.toggle("dark","dark"===t),t})};s.useEffect(()=>{{let e=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";i(e),document.documentElement.classList.toggle("dark","dark"===e)}},[]);let n=(0,s.useMemo)(()=>({theme:r,toggleTheme:l}),[r]);return(0,a.jsx)(x.Provider,{value:n,children:t})},u=(0,s.createContext)(void 0),h=()=>{let e=(0,s.useContext)(u);if(!e)throw Error("useNotification must be used within a NotificationProvider");return e},y=e=>{let{children:t}=e,[r,i]=(0,s.useState)([]),l=(e,t)=>{let r=Date.now(),a={id:r,message:e,type:t};i(e=>[...e,a]),setTimeout(()=>n(r),5e3)},n=e=>{i(t=>t.filter(t=>t.id!==e))},o=(0,s.useMemo)(()=>({notifications:r,addNotification:l,removeNotification:n}),[r]);return(0,a.jsxs)(u.Provider,{value:o,children:[t,(0,a.jsx)(p,{notifications:r,removeNotification:n})]})},p=e=>{let{notifications:t,removeNotification:r}=e;return(0,a.jsx)("div",{className:"fixed space-y-3 bottom-4 right-4 z-100",children:t.map(e=>{let t,o,d;switch(e.type){case"success":t=i.Z,o="bg-green-600",d="text-white";break;case"error":t=l.Z,o="bg-red-600",d="text-white";break;case"warning":t=l.Z,o="bg-yellow-500",d="text-gray-900";break;default:t=n.Z,o="bg-indigo-600",d="text-white"}return(0,a.jsxs)("div",{className:"p-4 rounded-lg shadow-xl flex items-center space-x-3 transition-opacity duration-300 animate-in fade-in slide-in-from-right ".concat(o," ").concat(d),role:"alert",children:[s.createElement(t,{className:"w-5 h-5 flex-shrink-0"}),(0,a.jsx)("span",{className:"text-sm font-medium",children:e.message}),(0,a.jsx)("button",{onClick:()=>r(e.id),className:"ml-4 opacity-70 hover:opacity-100 ".concat(d),children:"\xd7"})]},e.id)})})};function b(e){let{children:t}=e;return(0,a.jsx)(g,{children:(0,a.jsx)(d.H,{children:(0,a.jsx)(c.T,{children:(0,a.jsx)(y,{children:(0,a.jsx)("div",{className:"min-h-screen transition-colors duration-300 bg-gray-50 dark:bg-gray-900",children:t})})})})})}},64:function(e,t,r){"use strict";var a=r(7437),s=r(2265),i=r(243),l=r(6865),n=r(7769),o=r(2208),d=r(6540),c=r(9376);t.default=()=>{let e=(0,c.useRouter)(),{login:t,isAuthenticated:r,isLoading:x}=(0,i.a)(),[m,g]=(0,s.useState)(""),[u,h]=(0,s.useState)(""),[y,p]=(0,s.useState)(""),[b,f]=(0,s.useState)(!1),[j,v]=(0,s.useState)(!1),N=x||j,w=y||"",k=async r=>{if(r.preventDefault(),p(""),!m||!u){p("Please enter both email and password.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m)){p("Please enter a valid email address.");return}v(!0);try{let r=await t(m,u);r?p(r):e.push("/")}catch(e){p("Unexpected error during login.")}finally{v(!1)}};return((0,s.useEffect)(()=>{r&&e.push("/")},[r,e]),r)?(0,a.jsxs)("div",{className:"luno-redirect-message",children:[(0,a.jsx)("h2",{children:"\uD83C\uDF89 Welcome back to Luno!"}),(0,a.jsx)("p",{children:"You are already logged in. Redirecting to your dashboard..."}),(0,a.jsxs)("p",{className:"security-note",children:["If you're not automatically redirected,"," ",(0,a.jsx)("button",{onClick:()=>e.push("/"),className:"font-medium text-indigo-600 dark:text-indigo-400 hover:underline",children:"click here to go to dashboard"})]})]}):(0,a.jsxs)("div",{className:"luno-login-container",children:[(0,a.jsx)("h1",{className:"luno-logo",children:"Luno"}),(0,a.jsx)("h2",{children:"Secure Account Access"}),w&&(0,a.jsxs)("div",{className:"form-error fade-in-out",children:[(0,a.jsx)(l.Z,{className:"icon-alert",size:18}),(0,a.jsx)("strong",{children:"Error:"})," ",w]}),(0,a.jsxs)("form",{onSubmit:k,className:"login-form ".concat(N?"form-loading-animation":""),children:[(0,a.jsxs)("div",{className:"input-group",children:[(0,a.jsx)("label",{htmlFor:"email",children:"Email Address"}),(0,a.jsx)("input",{id:"email",type:"email",value:m,onChange:e=>g(e.target.value),placeholder:"e.g., satoshi@luno.io",required:!0,disabled:N})]}),(0,a.jsxs)("div",{className:"input-group password-group",children:[(0,a.jsx)("label",{htmlFor:"password",children:"Password"}),(0,a.jsxs)("div",{className:"password-input-wrapper",children:[(0,a.jsx)("input",{id:"password",type:b?"text":"password",value:u,onChange:e=>h(e.target.value),placeholder:"Min 8 characters",required:!0,disabled:N}),(0,a.jsx)("button",{type:"button",className:"password-toggle-button",onClick:()=>f(!b),disabled:N,"aria-label":b?"Hide password":"Show password",children:b?(0,a.jsx)(n.Z,{size:18}):(0,a.jsx)(o.Z,{size:18})})]}),(0,a.jsx)("a",{href:"/forgot-password",className:"forgot-password-link",children:"Forgot Password?"})]}),(0,a.jsx)("button",{type:"submit",className:"login-button ".concat(N?"button-busy":"button-ready"),disabled:N,children:N?(0,a.jsxs)("div",{className:"loading-content",children:[(0,a.jsx)(d.Z,{className:"loading-spinner",size:20}),(0,a.jsx)("span",{children:"Logging In..."})]}):"Log In to Your Wallet"}),(0,a.jsx)("p",{className:"security-note",children:"Your security is our priority. We use industry-leading encryption."})]}),(0,a.jsx)("div",{className:"signup-prompt",children:(0,a.jsxs)("p",{children:["Don't have an account? ",(0,a.jsx)("a",{href:"/signup",children:"Sign Up Now"})]})})]})}},5201:function(e,t,r){"use strict";r.d(t,{T:function(){return n},x:function(){return o}});var a=r(7437),s=r(2265),i=r(243);let l=(0,s.createContext)(void 0);function n(e){let{children:t}=e,{user:r,isAuthenticated:n,accessToken:o}=(0,i.a)(),[d,c]=(0,s.useState)("Not Verified"),[x,m]=(0,s.useState)(!0),g=async()=>{if(!n||!r){c("Not Verified"),m(!1);return}m(!0);try{let e={};o&&(e.Authorization="Bearer ".concat(o));let t=await fetch("/api/kyc/status",{headers:e});if(t.ok){let e=await t.json();c(e.status||"Not Verified")}else c("Not Verified")}catch(e){console.error("Error fetching KYC status:",e),c("Not Verified")}finally{m(!1)}};return(0,s.useEffect)(()=>{g()},[n,r]),(0,a.jsx)(l.Provider,{value:{kycStatus:d,checkKycStatus:g,isLoading:x},children:t})}function o(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useKyc must be used within a KycProvider");return e}},3500:function(e,t,r){"use strict";async function a(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:800,s=0;for(;s<=r;)try{let r=await fetch(e,t),a=r.headers.get("content-type")||"",s=null;if(a.includes("application/json"))try{s=await r.json()}catch(e){s=null}else try{s=await r.text()}catch(e){s=null}if(!r.ok){let e=s&&"object"==typeof s?s.details||s.error||s.message||JSON.stringify(s):s;return{ok:!1,status:r.status,error:e?String(e):"HTTP ".concat(r.status)}}return{ok:!0,status:r.status,data:s}}catch(l){let t=String(l||""),i=l instanceof TypeError||t.toLowerCase().includes("failed to fetch")||t.toLowerCase().includes("networkerror");if((s+=1)>r||!i){let r="";return t.toLowerCase().includes("failed to fetch")?r=" Possible causes: server unavailable, CORS policy blocking the request, mixed-content (https vs http), or a redirect loop. Check browser DevTools Network tab and server logs.":(t.toLowerCase().includes("too many redirects")||t.toLowerCase().includes("redirect"))&&(r=" The request encountered too many redirects (ERR_TOO_MANY_REDIRECTS). Check server-side redirects or middleware that may be redirecting the request repeatedly."),console.error("safeFetch final error for",e,l,r),{ok:!1,error:"".concat(t).concat(r)}}await new Promise(e=>setTimeout(e,a*s)),console.warn("safeFetch retrying (".concat(s,"/").concat(r,") for ").concat(e,": ").concat(t));continue}return{ok:!1,error:"Exceeded retry attempts"}}r.r(t),r.d(t,{safeFetch:function(){return a}})}},function(e){e.O(0,[358,139,256,839,53,971,117,744],function(){return e(e.s=6392)}),_N_E=e.O()}]);