(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{8217:function(e,r,t){Promise.resolve().then(t.bind(t,64))},7769:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9205).Z)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]])},2208:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9205).Z)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},6540:function(e,r,t){"use strict";t.d(r,{Z:function(){return s}});let s=(0,t(9205).Z)("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]])},9376:function(e,r,t){"use strict";var s=t(5475);t.o(s,"useRouter")&&t.d(r,{useRouter:function(){return s.useRouter}})},64:function(e,r,t){"use strict";var s=t(7437),a=t(2265),n=t(243),o=t(6865),i=t(7769),u=t(2208),l=t(6540),c=t(9376);r.default=()=>{let e=(0,c.useRouter)(),{login:r,isAuthenticated:t,isLoading:d}=(0,n.a)(),[h,p]=(0,a.useState)(""),[m,g]=(0,a.useState)(""),[f,y]=(0,a.useState)(""),[j,k]=(0,a.useState)(!1),[x,w]=(0,a.useState)(!1),b=d||x,v=f||"",S=async t=>{if(t.preventDefault(),y(""),!h||!m){y("Please enter both email and password.");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(h)){y("Please enter a valid email address.");return}w(!0);try{let t=await r(h,m);t?y(t):e.push("/")}catch(e){y("Unexpected error during login.")}finally{w(!1)}};return((0,a.useEffect)(()=>{t&&e.push("/")},[t,e]),t)?(0,s.jsxs)("div",{className:"luno-redirect-message",children:[(0,s.jsx)("h2",{children:"\uD83C\uDF89 Welcome back to Luno!"}),(0,s.jsx)("p",{children:"You are already logged in. Redirecting to your dashboard..."}),(0,s.jsxs)("p",{className:"security-note",children:["If you're not automatically redirected,"," ",(0,s.jsx)("button",{onClick:()=>e.push("/"),className:"font-medium text-indigo-600 dark:text-indigo-400 hover:underline",children:"click here to go to dashboard"})]})]}):(0,s.jsxs)("div",{className:"luno-login-container",children:[(0,s.jsx)("h1",{className:"luno-logo",children:"Luno"}),(0,s.jsx)("h2",{children:"Secure Account Access"}),v&&(0,s.jsxs)("div",{className:"form-error fade-in-out",children:[(0,s.jsx)(o.Z,{className:"icon-alert",size:18}),(0,s.jsx)("strong",{children:"Error:"})," ",v]}),(0,s.jsxs)("form",{onSubmit:S,className:"login-form ".concat(b?"form-loading-animation":""),children:[(0,s.jsxs)("div",{className:"input-group",children:[(0,s.jsx)("label",{htmlFor:"email",children:"Email Address"}),(0,s.jsx)("input",{id:"email",type:"email",value:h,onChange:e=>p(e.target.value),placeholder:"e.g., satoshi@luno.io",required:!0,disabled:b})]}),(0,s.jsxs)("div",{className:"input-group password-group",children:[(0,s.jsx)("label",{htmlFor:"password",children:"Password"}),(0,s.jsxs)("div",{className:"password-input-wrapper",children:[(0,s.jsx)("input",{id:"password",type:j?"text":"password",value:m,onChange:e=>g(e.target.value),placeholder:"Min 8 characters",required:!0,disabled:b}),(0,s.jsx)("button",{type:"button",className:"password-toggle-button",onClick:()=>k(!j),disabled:b,"aria-label":j?"Hide password":"Show password",children:j?(0,s.jsx)(i.Z,{size:18}):(0,s.jsx)(u.Z,{size:18})})]}),(0,s.jsx)("a",{href:"/forgot-password",className:"forgot-password-link",children:"Forgot Password?"})]}),(0,s.jsx)("button",{type:"submit",className:"login-button ".concat(b?"button-busy":"button-ready"),disabled:b,children:b?(0,s.jsxs)("div",{className:"loading-content",children:[(0,s.jsx)(l.Z,{className:"loading-spinner",size:20}),(0,s.jsx)("span",{children:"Logging In..."})]}):"Log In to Your Wallet"}),(0,s.jsx)("p",{className:"security-note",children:"Your security is our priority. We use industry-leading encryption."})]}),(0,s.jsx)("div",{className:"signup-prompt",children:(0,s.jsxs)("p",{children:["Don't have an account? ",(0,s.jsx)("a",{href:"/signup",children:"Sign Up Now"})]})})]})}},243:function(e,r,t){"use strict";t.d(r,{H:function(){return h},a:function(){return p}});var s=t(7437),a=t(2265),n=t(3301),o=t(738);t(5978);var i=t(62);let u=()=>{let e="AIzaSyB6VZGyh3S4IkOv1Wz81F1jd7oa-OlC1i0",r="luno-0.firebaseapp.com",t="luno-0";return e&&r&&t?{apiKey:e,authDomain:r,projectId:t,storageBucket:"luno-0.appspot.com",messagingSenderId:"368484485180",appId:"1:368484485180:web:3bd9361d2e566e4e045b39",measurementId:"G-1CVFF4B26Z"}:(console.error("CRITICAL: Firebase configuration is missing or incomplete in .env.local"),null)};function l(){if(0!==(0,o.C6)().length)return(0,o.Mq)();{let e=u();if(!e)throw Error("Firebase initialization failed due to missing configuration.");return(0,o.ZF)(e)}}let c=()=>{let e=l();return(0,n.v0)(e)};(()=>{let e=l();return(0,i.cF)(e)})();let d=(0,a.createContext)(void 0);function h(e){let{children:r}=e,[t,o]=(0,a.useState)(null),[i,u]=(0,a.useState)(null),[l,h]=(0,a.useState)(!0),p=c(),m=async e=>{if(!e.ok)return(await e.json()).error||"Authentication failed. Please try again.";let r=await e.json();return r.user&&r.user.id?(o({id:r.user.id,email:r.user.email,username:r.user.username,role:r.user.role||"trader",roles:r.user.roles||["trader"],migrationStatus:r.user.migrationStatus||"migrated",isAdmin:"admin"===r.user.role,accessToken:r.accessToken}),u(r.accessToken),localStorage.setItem("accessToken",r.accessToken),null):(console.error("Invalid auth response structure:",r),"Login successful, but the user object in the response was missing or malformed.")},g=async(e,r)=>{try{let t=await (0,n.e5)(p,e,r),s=await t.user.getIdToken(),a=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:s})});return await m(a)}catch(e){if(console.error("Login Error:",e),"auth/user-not-found"===e.code||"auth/wrong-password"===e.code||"auth/invalid-credential"===e.code)return"Invalid email or password.";return"Login failed. An unexpected error occurred."}},f=async(e,r,t)=>{try{let s=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:r,password:t})});if(!s.ok)return(await s.json()).error||"Signup failed. Please try again.";return await g(r,t)}catch(e){return console.error("Signup Error:",e),"Signup failed. An unexpected error occurred."}},y=()=>{p.signOut(),o(null),u(null),localStorage.removeItem("accessToken")};return(0,a.useEffect)(()=>{let e=(0,n.Aj)(p,async e=>{if(e)try{let r=await e.getIdToken(!0),t=await fetch("/api/auth/session",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)}});if(t.ok){let e=await t.json(),r={id:e.user.id,email:e.user.email,username:e.user.username,role:e.user.role||"trader",roles:e.user.roles||["trader"],migrationStatus:e.user.migrationStatus||"migrated",isAdmin:"admin"===e.user.role,accessToken:e.accessToken};o(r),u(e.accessToken),localStorage.setItem("accessToken",e.accessToken)}else y()}catch(e){console.error("Session refresh error:",e),y()}else o(null),u(null);h(!1)});return()=>e()},[p]),(0,s.jsx)(d.Provider,{value:{user:t,isAuthenticated:!!t,accessToken:i,login:g,signup:f,logout:y,isLoading:l},children:r})}function p(){let e=(0,a.useContext)(d);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},function(e){e.O(0,[358,139,256,971,117,744],function(){return e(e.s=8217)}),_N_E=e.O()}]);